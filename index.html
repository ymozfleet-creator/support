<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySUPPORTER | Ultimate Admin Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Inter', 'Noto Sans JP', sans-serif; 
            background-color: #f0f4f8; 
            color: #1e293b; 
            margin: 0; 
            overflow-x: hidden; 
        }

        /* èƒŒæ™¯è£…é£¾ */
        .bg-gradient-mesh {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
            background: radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 90% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 40%);
        }

        /* ãƒ‘ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.9); 
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.08);
        }

        .campaign-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .campaign-card:hover { 
            border-color: #3b82f6; 
            transform: translateY(-8px); 
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.15);
        }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-field { 
            background: #ffffff; 
            border: 1px solid #cbd5e1; 
            border-radius: 0.75rem; 
            padding: 0.75rem; 
            width: 100%; 
            outline: none; 
            color: #334155; 
            transition: 0.3s; 
            font-size: 14px; 
            font-weight: 600; 
        }
        .input-field:focus { 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15); 
        }

        /* ç®¡ç†ç”¨ã‚¿ãƒ– */
        .admin-tab { 
            padding: 0.75rem 1.5rem; 
            font-weight: 800; 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            letter-spacing: 0.05em; 
            transition: 0.3s; 
            border-radius: 0.75rem; 
            text-align: center; 
            color: #64748b; 
            white-space: nowrap; 
            cursor: pointer;
            background: white;
            border: 1px solid #e2e8f0;
        }
        .admin-tab:hover { background: #f8fafc; color: #3b82f6; }
        .admin-tab.active { background: #3b82f6; color: white; border-color: #3b82f6; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }

        .modal-overlay { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(5px); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .secret-trigger { cursor: default; user-select: none; }
        
        .goal-stamp { 
            animation: stamp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
            opacity: 0; 
            transform: scale(2) rotate(-15deg);
            color: #ec4899; 
            border-color: #ec4899;
        }
        @keyframes stamp { to { opacity: 1; transform: scale(1) rotate(-15deg); } }

        .loading-spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 3px solid #ffffff; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .meter-bg { background: #e2e8f0; height: 8px; border-radius: 99px; overflow: hidden; position: relative; }
        .meter-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #06b6d4, #3b82f6); 
            border-radius: 99px; 
            width: 0%; 
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); 
            position: relative; 
        }
        .meter-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); transform: translateX(-100%); animation: shimmer 2s infinite; }
        @keyframes shimmer { 100% { transform: translateX(100%); } }
    </style>
</head>
<body>
    <div class="bg-gradient-mesh"></div>
    <div id="root"></div>

    <script type="text/babel">
        // â–¼â–¼â–¼ Firebaseè¨­å®š (User ID: mysupporter-91816) â–¼â–¼â–¼
        const firebaseConfig = {
            apiKey: "AIzaSyBc6n-8U-8SNcM1CcP4r9sKweAhLcWajNc",
            authDomain: "mysupporter-91816.firebaseapp.com",
            projectId: "mysupporter-91816",
            storageBucket: "mysupporter-91816.firebasestorage.app",
            messagingSenderId: "184010562714",
            appId: "1:184010562714:web:fed9dbcf100b83a5c39323",
            measurementId: "G-E12NPFBT9H"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const functions = firebase.functions();
        // â–²â–²â–²â–²â–²â–²

        const { useState, useMemo, useEffect } = React;

        const ProgressBar = ({ current, target }) => {
            const percent = Math.min((current / target) * 100, 100);
            return (
                <div className="w-full mt-3">
                    <div className="flex justify-between items-end mb-1">
                        <span className="text-[10px] text-slate-400 font-bold">{Math.floor(percent)}%</span>
                        <span className="text-[10px] text-slate-400 font-bold">Goal</span>
                    </div>
                    <div className="meter-bg">
                        <div className="meter-fill" style={{ width: `${percent}%` }}></div>
                    </div>
                </div>
            );
        };

        const LegalModal = ({ title, content, isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-4 fade-in" onClick={onClose}>
                    <div className="bg-white border border-slate-200 w-full max-w-4xl max-h-[85vh] rounded-[2rem] overflow-hidden flex flex-col shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="p-6 md:p-8 border-b border-slate-100 flex justify-between items-center shrink-0 bg-slate-50">
                            <h2 className="text-lg md:text-xl font-black italic text-blue-600 uppercase tracking-tighter">{title}</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-blue-600 font-black text-xs tracking-widest transition-colors">CLOSE</button>
                        </div>
                        <div className="p-6 md:p-8 overflow-y-auto text-sm text-slate-600 leading-relaxed font-medium space-y-6 custom-scrollbar bg-white">
                            {content}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [view, setView] = useState('home'); 
            const [activeTab, setActiveTab] = useState('top'); 
            const [adminTab, setAdminTab] = useState('dashboard'); // åˆæœŸã‚¿ãƒ–ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«å¤‰æ›´
            const [searchQuery, setSearchQuery] = useState("");
            const [selectedCampaign, setSelectedCampaign] = useState(null);
            const [supportStep, setSupportStep] = useState(1);
            const [modal, setModal] = useState({ open: false, title: '', content: null });
            
            const [selectedAmount, setSelectedAmount] = useState(0); 
            const [customAmountInput, setCustomAmountInput] = useState(""); 
            const [supporterName, setSupporterName] = useState(""); 
            const [supporterEmail, setSupporterEmail] = useState(""); 
            const [isProcessing, setIsProcessing] = useState(false);

            const [showLogin, setShowLogin] = useState(false);
            const [loginEmail, setLoginEmail] = useState("");
            const [loginPass, setLoginPass] = useState("");
            const [rakutenCodes, setRakutenCodes] = useState({});

            const [applyForm, setApplyForm] = useState(() => {
                const saved = localStorage.getItem("ms_applyForm");
                return saved ? JSON.parse(saved) : { 
                    team: "", email: "", itemUrl: "", teamUrl: "", snsUrl: "", description: "", 
                    image: null, teamImage: null, contactName: "", address: "", phone: ""
                };
            });
            const [reportForm, setReportForm] = useState(() => {
                const saved = localStorage.getItem("ms_reportForm");
                return saved ? JSON.parse(saved) : { team: "", title: "", content: "", image: null };
            });

            const [applyAgreed, setApplyAgreed] = useState(false);
            const [campaigns, setCampaigns] = useState([]);
            const [requests, setRequests] = useState([]);
            const [reports, setReports] = useState([]);

            const calcTarget = (price) => Math.floor((price + 500) * 1.1);

            useEffect(() => {
                const unsubC = db.collection("campaigns").onSnapshot(snap => setCampaigns(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubR = db.collection("requests").onSnapshot(snap => setRequests(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubRep = db.collection("reports").onSnapshot(snap => setReports(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                return () => { unsubC(); unsubR(); unsubRep(); };
            }, []);

            const handleLocalUpdate = (id, field, value) => {
                setCampaigns(prev => prev.map(c => c.id === id ? { ...c, [field]: value } : c));
            };
            const saveToDB = async (id, field, value) => {
                try { await db.collection("campaigns").doc(id).update({ [field]: value }); } 
                catch(e) { console.error("Update failed", e); }
            };
            const handleRequestLocalUpdate = (id, field, value) => {
                setRequests(prev => prev.map(r => r.id === id ? { ...r, [field]: value } : r));
            };
            const saveRequestToDB = async (id, field, value) => {
                try { await db.collection("requests").doc(id).update({ [field]: value }); } 
                catch(e) { console.error("Update failed", e); }
            };

            // â–¼â–¼â–¼ ç”»åƒåœ§ç¸®å‡¦ç† (500px / 0.4 / 350KBåˆ¶é™) â–¼â–¼â–¼
            const handleImageUpload = (e, callback) => {
                const file = e.target.files[0];
                if (!file) return;
                
                if(file.size > 20 * 1024 * 1024) { alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚"); return; }

                const reader = new FileReader();
                reader.onload = (readerEvent) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        const MAX_SIZE = 500; 

                        if (width > height) {
                            if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; }
                        } else {
                            if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        const dataUrl = canvas.toDataURL('image/jpeg', 0.4);
                        
                        if (dataUrl.length > 350000) { 
                            alert("ç”»åƒã®åœ§ç¸®ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆã‚µã‚¤ã‚ºã‚ªãƒ¼ãƒãƒ¼ï¼‰ã€‚\nåˆ¥ã®ç”»åƒã‚’é¸æŠã™ã‚‹ã‹ã€ãƒˆãƒªãƒŸãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚");
                        } else {
                            callback(dataUrl);
                        }
                    };
                    img.src = readerEvent.target.result;
                };
                reader.readAsDataURL(file);
            };

            const docContent = {
                terms: (
                    <div className="space-y-8">
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ç¬¬1æ¡ï¼ˆç·å‰‡ï¼‰</h3><p>æœ¬è¦ç´„ã¯ã€MySUPPORTERé‹å–¶äº‹å‹™å±€ï¼ˆä»¥ä¸‹ã€Œç”²ã€ï¼‰ãŒæä¾›ã™ã‚‹ç‰©å“æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ŒMySUPPORTERã€ï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã®åˆ©ç”¨æ¡ä»¶ã‚’å®šã‚ã‚‹ã‚‚ã®ã§ã™ã€‚</p></div>
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ç¬¬2æ¡ï¼ˆæ”¯æ´é‡‘ã®ä½¿é€”ï¼‰</h3><ul className="list-disc pl-5 space-y-2 text-slate-600"><li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã‚µãƒãƒ¼ã‚¿ãƒ¼ã‹ã‚‰ã®æ”¯æ´é‡‘ã‚’åŸè³‡ã¨ã—ã¦ã€ç”²ãŒãƒãƒ¼ãƒ ã®å¸Œæœ›ã™ã‚‹ç‰©å“ã‚’ä»£ç†è³¼å…¥ã—ã€é…é€ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚</li></ul></div>
                    </div>
                ),
                privacy: (<div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</h3><p>å€‹äººæƒ…å ±ã¯å³é‡ã«ç®¡ç†ã—ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®é‹å–¶ä»¥å¤–ã®ç›®çš„ã«ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚</p></div>),
                tokusho: (<div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ç‰¹å®šå•†å–å¼•æ³•ã«åŸºã¥ãè¡¨è¨˜</h3><p>è²©å£²æ¥­è€…: MySUPPORTER é‹å–¶äº‹å‹™å±€<br/>é€£çµ¡å…ˆ: kanri@mycoach-myteam.com</p></div>)
            };

            const extractImageFromCode = (code) => {
                if (!code || typeof code !== 'string') return null;
                try {
                    const div = document.createElement('div');
                    div.innerHTML = code;
                    const img = div.querySelector('img');
                    if (img && img.src) return img.src;
                } catch (e) { console.error("Parse error", e); }
                const match = code.match(/<img[^>]+src=["']([^"']+)["']/i);
                return match ? match[1] : null;
            };

            const stats = useMemo(() => {
                const totalPayment = campaigns.reduce((acc, c) => acc + c.current, 0);
                return { 
                    totalPayment, 
                    activeCount: campaigns.length,
                    requestCount: requests.length
                };
            }, [campaigns, requests]);

            const handleLogin = () => {
                if (loginEmail === "y.moz.fleet@gmail.com" && loginPass === "Rushers1#") { 
                    setIsAdminMode(true); 
                    setView('admin'); 
                    setShowLogin(false); 
                } else { alert("èªè¨¼ã‚¨ãƒ©ãƒ¼"); }
            };
            const handleLogout = () => { setIsAdminMode(false); setView('home'); setLoginEmail(""); setLoginPass(""); };
            const handleCustomAmountChange = (e) => { setCustomAmountInput(e.target.value); setSelectedAmount(parseInt(e.target.value) || 0); };
            const shareText = (c) => encodeURIComponent(`ã€MySupporterã€‘${c.team}ã®ã€Œ${c.name}ã€ã‚’å¿œæ´ã—ã‚ˆã†ï¼`);
            const shareUrl = "https://mysupporter.example.com";
            const copyToClipboard = () => navigator.clipboard.writeText(shareUrl).then(() => alert("ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));

            const filteredCampaigns = useMemo(() => {
                return campaigns.filter(c => {
                    const match = !searchQuery || c.team.toLowerCase().includes(searchQuery.toLowerCase()) || c.name.toLowerCase().includes(searchQuery.toLowerCase());
                    return match && (c.status === 'active' || c.status === 'completed');
                }).sort((a,b) => (a.current >= calcTarget(a.price) ? 1 : -1));
            }, [campaigns, searchQuery]);

            const submitRequest = async () => {
                if(!applyForm.team || !applyForm.email || !applyForm.contactName) return alert("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                if(!applyAgreed) return alert("è¦ç´„ã¸ã®åŒæ„ãŒå¿…è¦ã§ã™");
                
                const teamImgSize = applyForm.teamImage ? applyForm.teamImage.length : 0;
                const itemImgSize = applyForm.image ? applyForm.image.length : 0;
                if ((teamImgSize + itemImgSize) > 950000) return alert("ç”»åƒã®åˆè¨ˆã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚å†åº¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚");

                setIsProcessing(true); 
                try {
                    await db.collection("requests").add({ ...applyForm, estimatedPrice: 0, status: "pending", date: new Date().toLocaleDateString('ja-JP') });
                    alert("ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚");
                    localStorage.removeItem("ms_applyForm");
                    setApplyForm({ team: "", email: "", itemUrl: "", teamUrl: "", snsUrl: "", description: "", image: null, teamImage: null, contactName: "", address: "", phone: "" });
                    setView('home');
                } catch (error) {
                    alert("é€ä¿¡å¤±æ•—: " + error.message);
                } finally { setIsProcessing(false); }
            };
            
            const approveRequest = async (req) => {
                if(!req.estimatedPrice) return alert("æ‰¿èªé‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                await db.collection("campaigns").add({ ...req, name: req.name || "å•†å“åæœªè¨­å®š", price: req.estimatedPrice, current: 0, supporters: 0, status: 'active', month: new Date().toISOString().slice(0, 7) });
                await db.collection("requests").doc(req.id).delete();
                alert("æ‰¿èªãƒ»å…¬é–‹ã—ã¾ã—ãŸ");
            };

            const handlePayment = async () => {
                if (!selectedAmount) return alert("é‡‘é¡ã‚¨ãƒ©ãƒ¼");
                setIsProcessing(true);
                try {
                    const createSquareCheckout = firebase.functions().httpsCallable('createSquareCheckout');
                    const response = await createSquareCheckout({ amount: selectedAmount, campaignId: selectedCampaign.id, name: supporterName, email: supporterEmail });
                    if (response.data && response.data.url) window.location.href = response.data.url;
                    else throw new Error("æ±ºæ¸ˆURLå–å¾—å¤±æ•—");
                } catch (error) {
                    alert("ã‚¨ãƒ©ãƒ¼: " + error.message);
                    setIsProcessing(false);
                }
            };

            const deleteDoc = async (col, id) => { if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) await db.collection(col).doc(id).delete(); };

            return (
                <div className="min-h-screen flex flex-col relative">
                    <LegalModal isOpen={modal.open} title={modal.title} content={modal.content} onClose={() => setModal({open: false, title: '', content: null})} />
                    
                    {showLogin && (
                        <div className="fixed inset-0 z-[100] bg-slate-900/80 backdrop-blur-md flex items-center justify-center fade-in">
                            <div className="glass-panel p-6 md:p-10 rounded-[2rem] w-full max-w-md border border-slate-200 shadow-2xl space-y-6 m-4">
                                <h3 className="text-2xl font-black italic uppercase text-blue-900 text-center">Admin Access</h3>
                                <input className="input-field" placeholder="Email" value={loginEmail} onChange={e=>setLoginEmail(e.target.value)} />
                                <input type="password" className="input-field" placeholder="Code" value={loginPass} onChange={e=>setLoginPass(e.target.value)} />
                                <button onClick={handleLogin} className="w-full py-4 bg-blue-600 text-white rounded-xl font-black italic shadow-lg hover:bg-blue-700">LOGIN</button>
                                <button onClick={()=>setShowLogin(false)} className="w-full text-xs text-slate-500 font-bold hover:text-slate-700">CANCEL</button>
                            </div>
                        </div>
                    )}

                    <nav className="h-20 md:h-24 flex items-center justify-between px-4 md:px-12 sticky top-0 bg-[#f0f4f8]/90 backdrop-blur-xl z-50 border-b border-white/40 gap-4 md:gap-8">
                        <div className="flex items-center gap-2 md:gap-3 cursor-pointer shrink-0" onClick={() => {setView('home'); setActiveTab('top'); setIsAdminMode(false);}}>
                            <div className="bg-blue-600 w-8 h-8 md:w-10 md:h-10 rounded-xl flex items-center justify-center italic font-black text-white shadow-lg text-lg md:text-xl">S</div>
                            <span className="font-black text-xl md:text-2xl tracking-tighter uppercase italic text-slate-900">MySUPPORTER <span className="text-[10px] text-blue-600 ml-2">Final</span></span>
                        </div>
                        {!isAdminMode && (
                            <div className="hidden md:block flex-1 max-w-xl relative border border-slate-200 bg-white rounded-2xl transition-all overflow-hidden focus-within:border-blue-500 shadow-sm">
                                <input type="text" placeholder="æ¤œç´¢..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="w-full bg-transparent py-3 px-12 outline-none text-sm font-bold text-slate-700 placeholder-slate-400" />
                            </div>
                        )}
                        <div className="flex gap-2 md:gap-4">
                            {!isAdminMode && <button onClick={()=>setView('apply')} className="text-[10px] font-black uppercase border border-blue-200 bg-white text-blue-900 px-4 md:px-6 py-2 rounded-full hover:bg-blue-600 hover:text-white transition shadow-sm">æ²è¼‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</button>}
                            {isAdminMode && <button onClick={handleLogout} className="text-[10px] font-black bg-slate-800 text-white px-4 md:px-6 py-2 rounded-full">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>}
                        </div>
                    </nav>

                    <main className="flex-grow">
                        {view === 'admin' && isAdminMode ? (
                            <div className="max-w-7xl mx-auto p-4 md:p-12 fade-in">
                                <div className="flex justify-between items-end border-b border-slate-300 pb-4 md:pb-8 mb-8">
                                    <h2 className="text-2xl md:text-4xl font-black italic text-blue-600 uppercase tracking-tighter">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                                </div>
                                <div className="flex flex-wrap bg-white p-2 rounded-2xl border border-slate-200 mb-8 gap-2 shadow-sm sticky top-24 z-40">
                                    {['dashboard', 'requests', 'campaigns'].map(t => (
                                        <button key={t} onClick={()=>setAdminTab(t)} className={`admin-tab ${adminTab===t ? 'active' : ''}`}>
                                            {t==='dashboard'?'ãƒ›ãƒ¼ãƒ (æ¦‚è¦)':t==='requests'?'ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª': 'å…¬é–‹ä¸­æ¡ˆä»¶ç·¨é›†'}
                                        </button>
                                    ))}
                                </div>

                                {adminTab === 'dashboard' && (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                                        <div className="glass-panel p-8 rounded-[2rem] border-l-8 border-blue-600">
                                            <p className="text-xs font-black text-slate-500 mb-2">ç¾åœ¨ã®ç·å£²ä¸Š</p>
                                            <p className="text-4xl font-black text-slate-800">Â¥{stats.totalPayment.toLocaleString()}</p>
                                        </div>
                                        <div className="glass-panel p-8 rounded-[2rem] border-l-8 border-orange-500">
                                            <p className="text-xs font-black text-slate-500 mb-2">æœªæ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆ</p>
                                            <p className="text-4xl font-black text-orange-500">{stats.requestCount}ä»¶</p>
                                        </div>
                                        <div className="glass-panel p-8 rounded-[2rem] border-l-8 border-green-500">
                                            <p className="text-xs font-black text-slate-500 mb-2">å…¬é–‹ä¸­ã®æ¡ˆä»¶</p>
                                            <p className="text-4xl font-black text-green-600">{stats.activeCount}ä»¶</p>
                                        </div>
                                    </div>
                                )}

                                {adminTab === 'requests' && <div className="grid gap-6">{requests.length === 0 ? <p className="text-center text-slate-400 py-10">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p> : requests.map(req => (
                                    <div key={req.id} className="glass-panel p-6 md:p-8 rounded-[2rem] grid grid-cols-1 md:grid-cols-3 gap-8 border-l-8 border-blue-600">
                                        <div className="space-y-4">
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-bold text-slate-500 flex justify-between">ãƒãƒ¼ãƒ å†™çœŸ (ãƒ¡ã‚¤ãƒ³)<button onClick={()=>saveRequestToDB(req.id, 'teamImage', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></label>
                                                <div className="aspect-video bg-slate-100 rounded-2xl overflow-hidden flex items-center justify-center relative shadow-inner group">
                                                    {req.teamImage ? <img src={req.teamImage} className="w-full h-full object-cover"/> : <span className="text-xs text-slate-400">ãªã—</span>}
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e => handleImageUpload(e, r => { handleRequestLocalUpdate(req.id, 'teamImage', r); saveRequestToDB(req.id, 'teamImage', r); })} /></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-bold text-slate-500 flex justify-between">å•†å“å†™çœŸ<button onClick={()=>saveRequestToDB(req.id, 'image', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></label>
                                                <div className="aspect-square bg-white rounded-xl overflow-hidden flex items-center justify-center border border-slate-200 group relative">
                                                    {req.image ? <img src={req.image} className="w-full h-full object-contain"/> : <span className="text-slate-400 font-bold text-xs">æœªè¨­å®š</span>}
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e => handleImageUpload(e, r => { handleRequestLocalUpdate(req.id, 'image', r); saveRequestToDB(req.id, 'image', r); })} /></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <a href={req.itemUrl} target="_blank" className="text-xs text-blue-500 underline block text-center">å•†å“URLã‚’ç¢ºèª</a>
                                        </div>
                                        <div className="md:col-span-2 space-y-4">
                                            <div className="flex justify-between items-start">
                                                <h3 className="text-2xl font-black text-slate-800">{req.team}</h3>
                                                <span className="bg-blue-100 text-blue-600 text-[10px] font-bold px-2 py-1 rounded">æ‰¿èªå¾…ã¡</span>
                                            </div>
                                            <div className="bg-white p-4 rounded-xl text-xs space-y-1 border border-slate-200 shadow-sm">
                                                <p><span className="text-slate-500 font-bold">æ‹…å½“è€…:</span> {req.contactName || 'æœªè¨˜å…¥'}</p>
                                                <p><span className="text-slate-500 font-bold">é›»è©±ç•ªå·:</span> {req.phone || 'æœªè¨˜å…¥'}</p>
                                                <p><span className="text-slate-500 font-bold">ä½æ‰€:</span> {req.address || 'æœªè¨˜å…¥'}</p>
                                                <p><span className="text-slate-500 font-bold">Email:</span> {req.email}</p>
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500">å•†å“å (æ‰¿èªå¾Œè¡¨ç¤º)</label>
                                                <input className="input-field text-sm" placeholder="å•†å“åã‚’å…¥åŠ› (ä¾‹: å…¬å¼è©¦åˆçƒ)" value={req.name||''} onChange={e => handleRequestLocalUpdate(req.id, 'name', e.target.value)} onBlur={e => saveRequestToDB(req.id, 'name', e.target.value)} />
                                            </div>
                                            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100"><label className="text-[10px] font-bold text-blue-600">æ‰¿èªé‡‘é¡ (Â¥)</label>
                                                <input type="number" className="input-field text-xl" value={req.estimatedPrice||''} onChange={e => handleRequestLocalUpdate(req.id, 'estimatedPrice', parseInt(e.target.value))} onBlur={e => saveRequestToDB(req.id, 'estimatedPrice', parseInt(e.target.value))} />
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500">ãƒªã‚¯ã‚¨ã‚¹ãƒˆç†ç”±</label>
                                                <textarea className="input-field text-sm h-20" value={req.description||''} onChange={e => handleRequestLocalUpdate(req.id, 'description', e.target.value)} onBlur={e => saveRequestToDB(req.id, 'description', e.target.value)}></textarea>
                                            </div>
                                            <div className="flex gap-4"><button onClick={()=>approveRequest(req)} className="flex-1 bg-blue-600 text-white py-3 rounded-xl font-black text-xs hover:bg-blue-700 shadow-lg transition transform hover:scale-[1.02]">æ‰¿èªã—ã¦å…¬é–‹</button><button onClick={()=>deleteDoc("requests", req.id)} className="px-8 border border-slate-300 text-red-500 rounded-xl font-black text-xs hover:bg-red-50 transition">å‰Šé™¤</button></div>
                                        </div>
                                    </div>
                                ))}</div>}

                                {adminTab === 'campaigns' && <div className="grid gap-4">{campaigns.map(c => (
                                    <div key={c.id} className="glass-panel p-6 rounded-3xl flex flex-col md:flex-row gap-6 items-start border-l-4 border-green-500">
                                        <div className="w-full md:w-48 shrink-0 space-y-4">
                                            <div>
                                                <p className="text-[10px] font-bold text-slate-500 mb-1 flex justify-between">ãƒãƒ¼ãƒ å†™çœŸ<button onClick={()=>saveToDB(c.id, 'teamImage', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></p>
                                                <div className="w-full aspect-video bg-slate-100 rounded-xl overflow-hidden relative group">
                                                    <img src={c.teamImage || "https://placehold.co/600x400"} className="w-full h-full object-cover"/>
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e=>handleImageUpload(e, r=>saveToDB(c.id, 'teamImage', r))} /></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <p className="text-[10px] font-bold text-slate-500 mb-1 flex justify-between">å•†å“ç”»åƒ<button onClick={()=>saveToDB(c.id, 'image', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></p>
                                                <div className="w-full h-24 bg-white rounded-xl overflow-hidden border border-slate-200 relative group">
                                                    <img src={c.image} className="w-full h-full object-contain"/>
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e=>handleImageUpload(e, r=>saveToDB(c.id, 'image', r))} /></label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex-grow space-y-4 w-full">
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                <div><label className="text-[10px] text-slate-500 font-bold">ãƒãƒ¼ãƒ å</label><input className="input-field py-1 px-2 text-xs" value={c.team} onChange={e=>handleLocalUpdate(c.id, 'team', e.target.value)} onBlur={e=>saveToDB(c.id, 'team', e.target.value)} /></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">å•†å“å</label><input className="input-field py-1 px-2 text-xs" value={c.name} onChange={e=>handleLocalUpdate(c.id, 'name', e.target.value)} onBlur={e=>saveToDB(c.id, 'name', e.target.value)} /></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">ä¾¡æ ¼</label><input type="number" className="input-field py-1 px-2 text-xs" value={c.price} onChange={e=>handleLocalUpdate(c.id, 'price', parseInt(e.target.value))} onBlur={e=>saveToDB(c.id, 'price', parseInt(e.target.value))} /></div>
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-slate-500 font-bold">èª¬æ˜æ–‡</label>
                                                <textarea className="input-field py-2 px-2 text-xs h-16" value={c.description||''} onChange={e=>handleLocalUpdate(c.id, 'description', e.target.value)} onBlur={e=>saveToDB(c.id, 'description', e.target.value)}></textarea>
                                            </div>
                                            <div className="flex justify-end pt-2">
                                                <button onClick={()=>deleteDoc("campaigns", c.id)} className="text-xs font-black border border-red-200 text-red-500 px-4 py-2 rounded-lg hover:bg-red-50">å‰Šé™¤</button>
                                            </div>
                                        </div>
                                    </div>
                                ))}</div>}
                            </div>
                        ) : view === 'home' ? (
                            <>
                                {/* Top: ãƒ’ãƒ¼ãƒ­ãƒ¼ãƒ“ã‚¸ãƒ§ãƒ³ + æ”¯æ´å‹Ÿé›†ä¸€è¦§ */}
                                {activeTab === 'top' && (
                                    <>
                                        <section className="pt-24 pb-12 md:pt-32 md:pb-24 px-4 md:px-8 text-center fade-in">
                                            <h1 className="text-5xl md:text-[9rem] font-black italic tracking-tighter uppercase leading-[0.9] text-slate-900 drop-shadow-sm">
                                                Support Your<br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-400">Dream Team.</span>
                                            </h1>
                                            <p className="text-lg md:text-3xl font-black text-slate-500 mt-6 md:mt-8 tracking-widest">
                                                ãã®ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãŒã€æœªæ¥ã®ã‚¢ã‚¹ãƒªãƒ¼ãƒˆã®åŠ›ã«ãªã‚‹ã€‚
                                            </p>
                                            <div className="w-16 h-1 md:w-24 md:h-2 bg-gradient-to-r from-blue-600 to-cyan-400 mx-auto mt-12 md:mt-16 rounded-full"></div>
                                        </section>

                                        {/* List */}
                                        <div className="max-w-7xl mx-auto px-2 md:px-8 grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-8 pb-32">
                                            {filteredCampaigns.map(c => {
                                                const target = calcTarget(c.price);
                                                const progress = Math.min((c.current / target) * 100, 100);
                                                const isGoal = c.current >= target;

                                                return (
                                                    <div key={c.id} className="campaign-card glass-panel rounded-[1.5rem] md:rounded-[2.5rem] p-2 border border-white relative cursor-pointer overflow-hidden" onClick={()=>{setSelectedCampaign(c); setView('detail'); setSupportStep(1); setCustomAmountInput(""); window.scrollTo(0,0);}}>
                                                        {isGoal && <div className="absolute inset-0 z-20 flex items-center justify-center bg-white/60 backdrop-blur-sm rounded-[2.5rem]"><div className="goal-stamp border-8 border-pink-500 text-pink-500 text-6xl font-black p-4 rounded-xl rotate-[-15deg]">GOAL!!</div></div>}
                                                        
                                                        {/* ãƒ¡ã‚¤ãƒ³: ãƒãƒ¼ãƒ ç”»åƒ */}
                                                        <div className="aspect-video bg-slate-100 rounded-[1rem] md:rounded-[2rem] overflow-hidden m-1 md:m-2 relative shadow-inner">
                                                            <img src={c.teamImage || c.image} className="w-full h-full object-cover"/>
                                                            <div className="absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/60 to-transparent">
                                                                <span className="bg-white text-blue-900 px-2 py-0.5 rounded-full text-[10px] font-black">{c.team}</span>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="p-3 md:p-6">
                                                            <h3 className="text-sm md:text-xl font-black italic text-slate-800 mt-2 mb-2 line-clamp-1">{c.name}</h3>
                                                            <div className="flex items-center gap-2 mb-2 text-[10px] md:text-xs font-bold text-slate-400"><span className="text-blue-500">ğŸ‘¤</span> {c.supporters || 0}äººãŒæ”¯æ´ä¸­</div>
                                                            <div className="flex justify-between items-end"><div><p className="text-[8px] md:text-[10px] text-slate-400">ç¾åœ¨</p><span className="text-sm md:text-2xl font-black text-blue-600">Â¥{c.current.toLocaleString()}</span></div><div className="text-right"><p className="text-[8px] md:text-[10px] text-slate-400">ç›®æ¨™</p><span className="text-[10px] md:text-xs font-black text-slate-500">/ Â¥{target.toLocaleString()}</span></div></div>
                                                            <ProgressBar current={c.current} target={target} />
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </>
                                )}
                            </>
                        ) : view === 'detail' ? (
                            <div className="max-w-6xl mx-auto p-2 md:p-4 pb-20">
                                <button onClick={()=>setView('home')} className="text-slate-400 font-black text-xs mb-2 hover:text-blue-600">â† BACK</button>
                                <div className="grid grid-cols-1 lg:grid-cols-5 gap-4">
                                    <div className="lg:col-span-3">
                                        <div className="glass-panel p-3 md:p-6 rounded-[1.5rem] md:rounded-[2rem] border-t-4 border-blue-600 relative overflow-hidden">
                                            {selectedCampaign.current >= calcTarget(selectedCampaign.price) && <div className="absolute top-4 right-4 z-20"><div className="goal-stamp border-4 border-pink-500 text-pink-500 text-3xl font-black p-2 rounded-lg rotate-[-15deg] opacity-50">GOAL!!</div></div>}
                                            
                                            {/* ãƒ¡ã‚¤ãƒ³: ãƒãƒ¼ãƒ å†™çœŸ */}
                                            <div className="relative rounded-xl md:rounded-2xl overflow-hidden aspect-video shadow-lg mb-6 group bg-slate-100">
                                                <img src={selectedCampaign.teamImage || selectedCampaign.image} className="w-full h-full object-cover transition duration-700 group-hover:scale-105"/>
                                                <div className="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                                                    <h2 className="text-xl md:text-3xl font-black italic text-white leading-tight">{selectedCampaign.name}</h2>
                                                    <p className="text-white/80 font-bold text-xs mt-1">{selectedCampaign.team}</p>
                                                </div>
                                            </div>

                                            {/* ã‚³ãƒ¡ãƒ³ãƒˆã¨å•†å“ç”»åƒ */}
                                            <div className="flex flex-col md:flex-row gap-6">
                                                <div className="flex-1 order-2 md:order-1">
                                                    <h4 className="text-[10px] md:text-xs font-black text-blue-600 uppercase mb-2 flex items-center gap-2">
                                                        <span className="w-8 h-[2px] bg-blue-600 inline-block"></span> Why we need this
                                                    </h4>
                                                    <div className="text-[12px] md:text-sm text-slate-600 font-medium whitespace-pre-wrap leading-relaxed">
                                                        {selectedCampaign.description}
                                                    </div>
                                                </div>
                                                
                                                {/* å•†å“ç”»åƒ (å³/ä¸Š) */}
                                                <div className="w-full md:w-40 shrink-0 order-1 md:order-2">
                                                    <div className="bg-white p-2 rounded-xl border border-slate-200 shadow-sm">
                                                        <div className="text-[10px] text-center font-bold text-slate-400 mb-1">Target Item</div>
                                                        <div className="w-full h-32 md:h-32 flex items-center justify-center overflow-hidden rounded-lg">
                                                            <img src={selectedCampaign.image} className="max-h-full max-w-full object-contain"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="mt-6 flex justify-end gap-2">
                                                <button onClick={copyToClipboard} className="w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center hover:bg-blue-600 hover:text-white transition text-xs text-slate-500">ğŸ”—</button>
                                                <a href={`https://twitter.com/intent/tweet?text=${shareText(selectedCampaign)}&url=${shareUrl}`} target="_blank" className="w-8 h-8 bg-black rounded-full flex items-center justify-center border border-slate-200 text-[10px] md:text-xs text-white">ğ•</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-2">
                                        <div className="glass-panel p-3 md:p-6 rounded-[1.5rem] md:rounded-[2rem] border border-white/50 sticky top-4 shadow-xl">
                                            {supportStep===1 && <div className="space-y-3 md:space-y-4">
                                                <h3 className="text-center font-black italic text-blue-600 text-xs md:text-sm">STEP 1: é‡‘é¡é¸æŠ</h3>
                                                <div className="text-center bg-blue-50/50 rounded-lg p-2 md:p-3 border border-blue-100">
                                                    {(() => {
                                                        const target = calcTarget(selectedCampaign.price);
                                                        const remaining = target - selectedCampaign.current;
                                                        if (remaining <= 0) return <><p className="text-lg md:text-xl font-black text-green-600">GOAL REACHED!</p><p className="text-[10px] text-slate-500">é”æˆæ¸ˆã¿</p></>;
                                                        return <><p className="text-[10px] text-slate-500">ã‚ã¨</p><p className="text-xl md:text-2xl font-black text-blue-900">Â¥{remaining.toLocaleString()}</p><p className="text-[10px] text-slate-500">ã§ã‚´ãƒ¼ãƒ«</p></>;
                                                    })()}
                                                </div>
                                                
                                                {(() => {
                                                    const remaining = calcTarget(selectedCampaign.price) - selectedCampaign.current;
                                                    if (remaining > 0) return (
                                                        <button onClick={()=>{setSelectedAmount(remaining);setSupportStep(2)}} className="w-full py-2 md:py-3 bg-gradient-to-r from-blue-600 to-cyan-500 text-white rounded-lg font-black italic text-[10px] md:text-xs hover:scale-[1.02] transition flex justify-between px-3 md:px-4 items-center shadow-lg">
                                                            <span className="text-[10px] opacity-90">å…¨é¡æ”¯æ´</span>
                                                            <span>Â¥{remaining.toLocaleString()}</span>
                                                        </button>
                                                    );
                                                })()}

                                                <div className="grid grid-cols-3 gap-2">{[1000,3000,5000].map(v=><button key={v} onClick={()=>{setSelectedAmount(v);setSupportStep(2)}} className="py-2 border border-slate-200 bg-white rounded-lg font-black text-[10px] md:text-xs hover:border-blue-500 hover:text-blue-600 text-slate-600 transition">Â¥{v.toLocaleString()}</button>)}</div>
                                                <div className="flex gap-2"><input type="number" className="input-field text-center text-xs py-2 h-8 md:h-auto" placeholder="é‡‘é¡æŒ‡å®š" onChange={handleCustomAmountChange}/><button onClick={()=>{if(selectedAmount>=1000)setSupportStep(2)}} className="px-3 bg-slate-800 text-white rounded-lg font-black text-[10px] md:text-xs whitespace-nowrap hover:bg-slate-900">æ±ºå®š</button></div>
                                            </div>}
                                            {supportStep===2 && <div className="space-y-3 md:space-y-4">
                                                <h3 className="text-center font-black italic text-blue-600 text-xs md:text-sm">STEP 2: æƒ…å ±</h3>
                                                <p className="text-center text-lg md:text-xl font-black text-slate-900">Â¥{selectedAmount.toLocaleString()}</p>
                                                <input className="input-field text-xs py-2 h-8 md:h-auto" placeholder="åå‰" value={supporterName} onChange={e=>setSupporterName(e.target.value)} />
                                                <input className="input-field text-xs py-2 h-8 md:h-auto" placeholder="Email" value={supporterEmail} onChange={e=>setSupporterEmail(e.target.value)} />
                                                <button onClick={()=>setSupportStep(3)} className="w-full py-2 md:py-3 bg-blue-600 text-white rounded-lg font-black text-xs md:text-sm hover:bg-blue-700 shadow-lg">æ¬¡ã¸</button>
                                            </div>}
                                            {supportStep===3 && <div className="space-y-3 text-center py-2">
                                                <h3 className="font-black italic text-xs md:text-sm text-blue-600">STEP 3: æ±ºæ¸ˆ</h3>
                                                <p className="text-[10px] text-slate-500">Squareæ±ºæ¸ˆã¸ç§»å‹•ã—ã¾ã™</p>
                                                <button 
                                                    onClick={isProcessing ? null : handlePayment} 
                                                    disabled={isProcessing}
                                                    className={`w-full py-2 md:py-3 bg-blue-600 text-white rounded-lg font-black text-sm md:text-lg shadow-xl ${isProcessing ? 'opacity-50 cursor-not-allowed' : 'hover:scale-[1.02] hover:bg-blue-700'}`}
                                                >
                                                    {isProcessing ? <div className="loading-spinner"></div> : "Squareã§æ±ºæ¸ˆã™ã‚‹"}
                                                </button>
                                                <p id="status-message" className="text-[10px] text-red-500 mt-2"></p>
                                            </div>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : view === 'apply' ? (
                            <div className="max-w-2xl mx-auto py-12 md:py-24 px-4 md:px-8 fade-in">
                                <h2 className="text-3xl md:text-4xl font-black italic text-center text-blue-600 mb-8 md:mb-16">æ²è¼‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
                                <div className="glass-panel p-6 md:p-12 rounded-[2rem] md:rounded-[4rem] space-y-6 border-t-[12px] border-blue-600 shadow-2xl">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                                            <p className="text-xs font-bold text-blue-800 mb-2">ğŸ“¸ ãƒãƒ¼ãƒ å†™çœŸ (ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºç”¨)</p>
                                            <div className="w-full aspect-video bg-white rounded-xl overflow-hidden flex items-center justify-center border border-blue-100 relative group">
                                                {applyForm.teamImage ? <img src={applyForm.teamImage} className="w-full h-full object-cover"/> : <span className="text-blue-200 font-bold text-2xl">+</span>}
                                                <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => handleImageUpload(e, r => setApplyForm({...applyForm, teamImage: r}))} />
                                            </div>
                                        </div>
                                        <div className="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                                            <p className="text-xs font-bold text-blue-800 mb-2">ğŸ å•†å“ç”»åƒ (ä»»æ„)</p>
                                            <div className="w-full aspect-video bg-white rounded-xl overflow-hidden flex items-center justify-center border border-blue-100 relative group">
                                                {applyForm.image ? <img src={applyForm.image} className="w-full h-full object-contain"/> : <span className="text-blue-200 font-bold text-2xl">+</span>}
                                                <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => handleImageUpload(e, r => setApplyForm({...applyForm, image: r}))} />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4"><input className="input-field" placeholder="ãƒãƒ¼ãƒ å" value={applyForm.team} onChange={e=>setApplyForm({...applyForm, team: e.target.value})} /><input className="input-field" placeholder="Email (é€£çµ¡ç”¨)" value={applyForm.email} onChange={e=>setApplyForm({...applyForm, email: e.target.value})} /></div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input className="input-field" placeholder="ãŠåå‰ (æ‹…å½“è€…)" value={applyForm.contactName} onChange={e=>setApplyForm({...applyForm, contactName: e.target.value})} />
                                        <input className="input-field" placeholder="é›»è©±ç•ªå·" value={applyForm.phone} onChange={e=>setApplyForm({...applyForm, phone: e.target.value})} />
                                    </div>
                                    <input className="input-field" placeholder="ç™ºé€å…ˆä½æ‰€ (ã€’å«ã‚€)" value={applyForm.address} onChange={e=>setApplyForm({...applyForm, address: e.target.value})} />
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4"><input className="input-field" placeholder="ãƒãƒ¼ãƒ URL" value={applyForm.teamUrl} onChange={e=>setApplyForm({...applyForm, teamUrl: e.target.value})} /><input className="input-field" placeholder="SNS URL" value={applyForm.snsUrl} onChange={e=>setApplyForm({...applyForm, snsUrl: e.target.value})} /></div>
                                    <input className="input-field" placeholder="ã»ã—ã„å•†å“URL (Amazon/æ¥½å¤©)" value={applyForm.itemUrl} onChange={e=>setApplyForm({...applyForm, itemUrl: e.target.value})} />
                                    <textarea className="input-field h-32" placeholder="ãƒªã‚¯ã‚¨ã‚¹ãƒˆç†ç”± (Why we need this)" value={applyForm.description} onChange={e=>setApplyForm({...applyForm, description: e.target.value})}></textarea>
                                    
                                    <div className="bg-white p-4 rounded-xl flex gap-4 items-start border border-slate-200">
                                        <input type="checkbox" className="mt-1" checked={applyAgreed} onChange={()=>setApplyAgreed(!applyAgreed)} />
                                        <p className="text-xs text-slate-500">åˆ©ç”¨è¦ç´„ãŠã‚ˆã³è™šå½ç”³è«‹ã§ãªã„ã“ã¨ã«åŒæ„ã—ã¾ã™ã€‚</p>
                                    </div>
                                    <p className="text-[10px] text-center text-slate-400">â€»ç™ºé€å…ˆæƒ…å ±ã¯DBã«ã¯ä¿å­˜ã•ã‚Œãšã€ç®¡ç†è€…ã¸ã®ãƒ¡ãƒ¼ãƒ«ã§ã®ã¿é€ä¿¡ã•ã‚Œã¾ã™ã€‚</p>
                                    <button 
                                        onClick={isProcessing ? null : submitRequest} 
                                        disabled={isProcessing || !applyAgreed}
                                        className={`w-full py-6 bg-blue-600 text-white rounded-3xl font-black text-xl shadow-xl transition flex justify-center items-center ${isProcessing || !applyAgreed ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'}`}
                                    >
                                        {isProcessing ? <div className="loading-spinner border-white border-t-blue-600 w-6 h-6"></div> : "é€ä¿¡"}
                                    </button>
                                </div>
                            </div>
                        ) : null}
                    </main>

                    <footer className="border-t border-slate-200 py-16 px-8 bg-white text-center md:text-left">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
                            <div><span className="font-black italic text-xl text-slate-900">MySUPPORTER</span><p onClick={()=>{if(!isAdminMode)setShowLogin(true)}} className={`text-[10px] font-bold text-slate-400 tracking-widest mt-2 ${!isAdminMode && "cursor-pointer hover:text-slate-600 secret-trigger"}`}>Â© 2026 MySUPPORTER. All Rights Reserved.</p></div>
                            <div className="flex flex-wrap justify-center gap-6">
                                <button onClick={()=>setModal({open:true, title:'åˆ©ç”¨è¦ç´„', content:docContent.terms})} className="text-[10px] font-black text-slate-500 hover:text-blue-600">åˆ©ç”¨è¦ç´„</button>
                                <button onClick={()=>setModal({open:true, title:'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼', content:docContent.privacy})} className="text-[10px] font-black text-slate-500 hover:text-blue-600">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</button>
                                <button onClick={()=>setModal({open:true, title:'ç‰¹å•†æ³•', content:docContent.tokusho})} className="text-[10px] font-black text-slate-500 hover:text-blue-600">ç‰¹å•†æ³•è¡¨è¨˜</button>
                                <a href="https://ymozfleet-creator.github.io/Ark/" target="_blank" className="text-[10px] font-black text-slate-500 hover:text-blue-600">é‹å–¶ä¼šç¤¾</a>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
