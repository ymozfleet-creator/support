<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySUPPORTER | Ultimate Integrated Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Inter', 'Noto Sans JP', sans-serif; 
            background-color: #f0f4f8; 
            color: #1e293b; 
            margin: 0; 
            overflow-x: hidden; 
        }

        .bg-gradient-mesh {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
            background: radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 40%),
                        radial-gradient(circle at 90% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 40%);
        }

        .glass-panel { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.9); 
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.08);
        }

        .campaign-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .campaign-card:hover { 
            border-color: #3b82f6; 
            transform: translateY(-8px); 
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.15);
        }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-field { 
            background: #ffffff; 
            border: 1px solid #cbd5e1; 
            border-radius: 0.75rem; 
            padding: 0.75rem; 
            width: 100%; 
            outline: none; 
            color: #334155; 
            transition: 0.3s; 
            font-size: 14px; 
            font-weight: 600; 
        }
        .input-field:focus { 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15); 
        }

        .admin-tab { 
            padding: 0.75rem 1.5rem; 
            font-weight: 800; 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            letter-spacing: 0.05em; 
            transition: 0.3s; 
            border-radius: 0.75rem; 
            text-align: center; 
            color: #64748b; 
            white-space: nowrap; 
            cursor: pointer;
            background: white;
            border: 1px solid #e2e8f0;
        }
        .admin-tab:hover { background: #f8fafc; color: #3b82f6; }
        .admin-tab.active { background: #3b82f6; color: white; border-color: #3b82f6; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }

        .modal-overlay { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(5px); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .secret-trigger { cursor: default; user-select: none; }
        
        .goal-stamp { 
            animation: stamp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
            opacity: 0; 
            transform: scale(2) rotate(-15deg);
            color: #ec4899; 
            border-color: #ec4899;
        }
        @keyframes stamp { to { opacity: 1; transform: scale(1) rotate(-15deg); } }

        .loading-spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 3px solid #ffffff; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .meter-bg { background: #e2e8f0; height: 8px; border-radius: 99px; overflow: hidden; position: relative; }
        .meter-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #06b6d4, #3b82f6); 
            border-radius: 99px; 
            width: 0%; 
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); 
            position: relative; 
        }
        .meter-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent); transform: translateX(-100%); animation: shimmer 2s infinite; }
        @keyframes shimmer { 100% { transform: translateX(100%); } }
    </style>
</head>
<body>
    <div class="bg-gradient-mesh"></div>
    <div id="root"></div>

    <script type="text/babel">
        // â–¼â–¼â–¼ Firebaseè¨­å®š (User ID: mysupporter-91816) â–¼â–¼â–¼
        const firebaseConfig = {
            apiKey: "AIzaSyBc6n-8U-8SNcM1CcP4r9sKweAhLcWajNc",
            authDomain: "mysupporter-91816.firebaseapp.com",
            projectId: "mysupporter-91816",
            storageBucket: "mysupporter-91816.firebasestorage.app",
            messagingSenderId: "184010562714",
            appId: "1:184010562714:web:fed9dbcf100b83a5c39323",
            measurementId: "G-E12NPFBT9H"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const functions = firebase.functions();
        // â–²â–²â–²â–²â–²â–²

        const { useState, useMemo, useEffect } = React;

        const ProgressBar = ({ current, target }) => {
            const percent = Math.min((current / target) * 100, 100);
            return (
                <div className="w-full mt-2">
                    <div className="flex justify-between items-end mb-1">
                        <span className="text-[9px] md:text-[10px] text-slate-400 font-bold">{Math.floor(percent)}%</span>
                        <span className="text-[9px] md:text-[10px] text-slate-400 font-bold">Goal</span>
                    </div>
                    <div className="meter-bg h-[6px] md:h-[8px]">
                        <div className="meter-fill" style={{ width: `${percent}%` }}></div>
                    </div>
                </div>
            );
        };

        const LegalModal = ({ title, content, isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-4 fade-in" onClick={onClose}>
                    <div className="bg-white border border-slate-200 w-full max-w-4xl max-h-[85vh] rounded-[2rem] overflow-hidden flex flex-col shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="p-6 md:p-8 border-b border-slate-100 flex justify-between items-center shrink-0 bg-slate-50">
                            <h2 className="text-lg md:text-xl font-black italic text-blue-600 uppercase tracking-tighter">{title}</h2>
                            <button onClick={onClose} className="text-slate-400 hover:text-blue-600 font-black text-xs tracking-widest transition-colors">CLOSE</button>
                        </div>
                        <div className="p-6 md:p-8 overflow-y-auto text-sm text-slate-600 leading-relaxed font-medium space-y-6 custom-scrollbar bg-white">
                            {content}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [view, setView] = useState('home'); 
            const [activeTab, setActiveTab] = useState('top'); 
            const [adminTab, setAdminTab] = useState('dashboard');
            const [searchQuery, setSearchQuery] = useState("");
            const [selectedCampaign, setSelectedCampaign] = useState(null);
            const [supportStep, setSupportStep] = useState(1);
            const [modal, setModal] = useState({ open: false, title: '', content: null });
            
            const [selectedAmount, setSelectedAmount] = useState(0); 
            const [customAmountInput, setCustomAmountInput] = useState(""); 
            const [supporterName, setSupporterName] = useState(""); 
            const [supporterEmail, setSupporterEmail] = useState(""); 
            const [isProcessing, setIsProcessing] = useState(false);

            const [showLogin, setShowLogin] = useState(false);
            const [loginEmail, setLoginEmail] = useState("");
            const [loginPass, setLoginPass] = useState("");
            const [rakutenCodes, setRakutenCodes] = useState({});

            const [applyForm, setApplyForm] = useState(() => {
                const saved = localStorage.getItem("ms_applyForm");
                return saved ? JSON.parse(saved) : { 
                    team: "", email: "", itemUrl: "", teamUrl: "", snsUrl: "", description: "", 
                    image: null, teamImage: null, contactName: "", address: "", phone: ""
                };
            });
            const [reportForm, setReportForm] = useState(() => {
                const saved = localStorage.getItem("ms_reportForm");
                return saved ? JSON.parse(saved) : { team: "", title: "", content: "", image: null };
            });

            const [applyAgreed, setApplyAgreed] = useState(false);
            const [campaigns, setCampaigns] = useState([]);
            const [requests, setRequests] = useState([]);
            const [reports, setReports] = useState([]);

            const calcTarget = (price) => Math.floor((price + 500) * 1.1);

            useEffect(() => {
                const unsubC = db.collection("campaigns").onSnapshot(snap => setCampaigns(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubR = db.collection("requests").onSnapshot(snap => setRequests(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                const unsubRep = db.collection("reports").onSnapshot(snap => setReports(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
                return () => { unsubC(); unsubR(); unsubRep(); };
            }, []);

            useEffect(() => {
                localStorage.setItem("ms_isAdmin", isAdminMode);
                if (!isAdminMode) setView('home'); 
            }, [isAdminMode]);

            const handleLocalUpdate = (id, field, value) => {
                setCampaigns(prev => prev.map(c => c.id === id ? { ...c, [field]: value } : c));
            };
            const saveToDB = async (id, field, value) => {
                try { await db.collection("campaigns").doc(id).update({ [field]: value }); } 
                catch(e) { console.error("Update failed", e); try { await db.collection("campaigns").doc(id).set({ [field]: value }, { merge: true }); } catch (e2) { alert("ä¿å­˜å¤±æ•—: " + e2.message); } }
            };
            const handleRequestLocalUpdate = (id, field, value) => {
                setRequests(prev => prev.map(r => r.id === id ? { ...r, [field]: value } : r));
            };
            const saveRequestToDB = async (id, field, value) => {
                try { await db.collection("requests").doc(id).update({ [field]: value }); } 
                catch(e) { console.error("Update failed", e); try { await db.collection("requests").doc(id).set({ [field]: value }, { merge: true }); } catch (e2) { alert("ä¿å­˜å¤±æ•—: " + e2.message); } }
            };

            const handleImageUpload = (e, callback) => {
                const file = e.target.files[0];
                if (!file) return;
                if(file.size > 20 * 1024 * 1024) { alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚"); return; }
                const reader = new FileReader();
                reader.onload = (readerEvent) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        const MAX_SIZE = 500; 
                        if (width > height) { if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; } } else { if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; } }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.4);
                        if (dataUrl.length > 350000) { alert("ç”»åƒã®åœ§ç¸®ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆ¥ã®ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"); } else { callback(dataUrl); }
                    };
                    img.src = readerEvent.target.result;
                };
                reader.readAsDataURL(file);
            };

            const docContent = {
                terms: (
                    <div className="space-y-8">
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ç¬¬1æ¡ï¼ˆç·å‰‡ï¼‰</h3><p>æœ¬è¦ç´„ã¯ã€MySUPPORTERé‹å–¶äº‹å‹™å±€ï¼ˆä»¥ä¸‹ã€Œç”²ã€ï¼‰ãŒæä¾›ã™ã‚‹ç‰©å“æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ŒMySUPPORTERã€ï¼ˆä»¥ä¸‹ã€Œæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã€ï¼‰ã®åˆ©ç”¨æ¡ä»¶ã‚’å®šã‚ã‚‹ã‚‚ã®ã§ã™ã€‚åˆ©ç”¨è€…ã¯æœ¬è¦ç´„ã«åŒæ„ã®ä¸Šã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p></div>
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ç¬¬2æ¡ï¼ˆæ”¯æ´é‡‘ã®ä½¿é€”ã¨ä»•çµ„ã¿ï¼‰</h3><ul className="list-disc pl-5 space-y-2 text-slate-600"><li>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã‚µãƒãƒ¼ã‚¿ãƒ¼ã‹ã‚‰ã®æ”¯æ´é‡‘ã‚’åŸè³‡ã¨ã—ã¦ã€ç”²ãŒãƒãƒ¼ãƒ ã®å¸Œæœ›ã™ã‚‹ç‰©å“ã‚’ä»£ç†è³¼å…¥ã—ã€é…é€ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚</li><li>æ”¯æ´é‡‘ã«ã¯ã€ç‰©å“ä»£é‡‘ã®ã»ã‹ã€ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™ï¼ˆ10%ï¼‰ã€é…é€ãƒ»æ¢±åŒ…ç­‰ã®äº‹å‹™æ‰‹æ•°æ–™ï¼ˆä¸€å¾‹500å††ï¼‰ãŒå«ã¾ã‚Œã¾ã™ã€‚</li><li>ç›®æ¨™é‡‘é¡ã«åˆ°é”ã—ãŸæ™‚ç‚¹ã§æ±ºæ¸ˆãŒç¢ºå®šã—ã€ç‰©å“ã®æ‰‹é…ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</li></ul></div>
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg text-blue-600">ç¬¬3æ¡ï¼ˆè¡¨æ˜ä¿è¨¼ãŠã‚ˆã³ç¦æ­¢äº‹é …ï¼‰</h3><p>æ²è¼‰ã‚’ç”³è«‹ã™ã‚‹ãƒãƒ¼ãƒ ä»£è¡¨è€…ã¯ã€ä»¥ä¸‹ã®äº‹é …ã‚’è¡¨æ˜ã—ä¿è¨¼ã—ã¾ã™ã€‚</p><ul className="list-disc pl-5 mt-2 space-y-2 text-slate-600"><li>å®Ÿåœ¨ã™ã‚‹å›£ä½“ã§ã‚ã‚Šã€å…·ä½“çš„ãªæ´»å‹•å®Ÿæ…‹ãŒã‚ã‚‹ã“ã¨ã€‚</li><li>ç”³è«‹å†…å®¹ï¼ˆãƒãƒ¼ãƒ åã€æ´»å‹•å†…å®¹ã€ç‰©å“ã®å¿…è¦æ€§ï¼‰ã«ä¸€åˆ‡ã®è™šå½ãŒãªã„ã“ã¨ã€‚</li><li>åç¤¾ä¼šçš„å‹¢åŠ›ï¼ˆæš´åŠ›å›£ã€æš´åŠ›å›£å“¡ã€ãã®ä»–ã“ã‚Œã«æº–ãšã‚‹è€…ï¼‰ã«è©²å½“ã—ãªã„ã“ã¨ã€‚</li></ul><p className="mt-2 text-red-500 font-bold">â€»è™šå½ã®ç”³è«‹ã«ã‚ˆã‚Šé‡‘éŠ­ã¾ãŸã¯ç‰©å“ã‚’å—é ˜ã—ãŸå ´åˆã€è©æ¬ºç½ªã¨ã—ã¦ã®åˆ‘äº‹å‘Šè¨´ãŠã‚ˆã³æå®³è³ å„Ÿè«‹æ±‚ã‚’è¡Œã„ã¾ã™ã€‚</p></div>
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">ç¬¬4æ¡ï¼ˆè¿”é‡‘ãƒ»å…è²¬ï¼‰</h3><p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®æ€§è³ªä¸Šï¼ˆå¯„ä»˜ãƒ»æ”¯æ´ï¼‰ã€åŸå‰‡ã¨ã—ã¦æ±ºæ¸ˆå®Œäº†å¾Œã®ã‚µãƒãƒ¼ã‚¿ãƒ¼éƒ½åˆã«ã‚ˆã‚‹è¿”é‡‘ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯å—ã‘ä»˜ã‘ã¾ã›ã‚“ã€‚ãŸã ã—ã€ãƒãƒ¼ãƒ ã®è§£æ•£ã‚„æ´»å‹•åœæ­¢ã«ã‚ˆã‚Šç‰©å“é€ä»˜ãŒä¸èƒ½ã¨ãªã£ãŸå ´åˆã¯ã€ç”²ã®åˆ¤æ–­ã«ã‚ˆã‚Šè¿”é‡‘ç­‰ã®æªç½®ã‚’è¬›ã˜ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p></div>
                    </div>
                ),
                privacy: (
                    <div className="space-y-8">
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">1. å€‹äººæƒ…å ±ã®åé›†</h3><p>æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€æ±ºæ¸ˆå‡¦ç†ãŠã‚ˆã³å•†å“é…é€ã€æ´»å‹•å ±å‘Šã®ãŸã‚ã«ã€ä»¥ä¸‹ã®å€‹äººæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚</p><ul className="list-disc pl-5 mt-2 text-slate-600"><li>æ°åã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€é›»è©±ç•ªå·ã€ä½æ‰€ï¼ˆé…é€å…ˆã®ã¿ï¼‰ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ï¼ˆæ±ºæ¸ˆä»£è¡Œæ¥­è€…ã®ã¿ãŒä¿æŒï¼‰</li></ul></div>
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">2. å€‹äººæƒ…å ±ã®åˆ©ç”¨ç›®çš„</h3><p>å–å¾—ã—ãŸæƒ…å ±ã¯ã€ä»¥ä¸‹ã®ç›®çš„ä»¥å¤–ã«ã¯åˆ©ç”¨ã—ã¾ã›ã‚“ã€‚</p><ul className="list-disc pl-5 mt-2 text-slate-600"><li>æ”¯æ´ç‰©å“ã®è³¼å…¥ãŠã‚ˆã³é…é€æ¥­å‹™</li><li>æ±ºæ¸ˆæ‰‹ç¶šããŠã‚ˆã³é ˜åæ›¸ç­‰ã®ç™ºè¡Œ</li><li>ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹é‡è¦ã®ãŠçŸ¥ã‚‰ã›ã€æ´»å‹•å ±å‘Šã®é€ä»˜</li></ul></div>
                        <div><h3 className="text-blue-900 font-bold border-b border-slate-200 pb-2 mb-4 text-lg">3. ç¬¬ä¸‰è€…æä¾›</h3><p>æ³•ä»¤ã«åŸºã¥ãå ´åˆã‚’é™¤ãã€åˆ©ç”¨è€…ã®åŒæ„ãªãç¬¬ä¸‰è€…ã«å€‹äººæƒ…å ±ã‚’æä¾›ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã ã—ã€æ”¯æ´å…ˆã®ãƒãƒ¼ãƒ ã«å¯¾ã—ã¦ã¯ã€æ”¯æ´è€…ãƒªã‚¹ãƒˆã¨ã—ã¦æ°åï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼‰ã®ã¿é–‹ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p></div>
                    </div>
                ),
                tokusho: (
                    <div className="space-y-6">
                        <table className="w-full text-left text-sm border-collapse"><tbody className="divide-y divide-slate-200">
                            <tr><th className="py-4 text-blue-900 w-1/3">è²©å£²æ¥­è€…</th><td className="py-4 text-slate-600">MySUPPORTER é‹å–¶äº‹å‹™å±€</td></tr>
                            <tr><th className="py-4 text-blue-900">é‹å–¶çµ±æ‹¬è²¬ä»»è€…</th><td className="py-4 text-slate-600">èŒ‚ä½ é›„å¤ª</td></tr>
                            <tr><th className="py-4 text-blue-900">æ‰€åœ¨åœ°</th><td className="py-4 text-slate-600">æ±äº¬éƒ½ä¸­é‡åŒºï¼ˆè«‹æ±‚ãŒã‚ã‚Šæ¬¡ç¬¬ã€é…æ»ãªãé–‹ç¤ºã—ã¾ã™ï¼‰</td></tr>
                            <tr><th className="py-4 text-blue-900">é€£çµ¡å…ˆ</th><td className="py-4 text-blue-600">kanri@mycoach-myteam.com</td></tr>
                            <tr><th className="py-4 text-blue-900">è²©å£²ä¾¡æ ¼</th><td className="py-4 text-slate-600">å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒšãƒ¼ã‚¸ã«è¨˜è¼‰ï¼ˆå•†å“ä»£é‡‘ï¼‹ã‚·ã‚¹ãƒ†ãƒ æ‰‹æ•°æ–™ï¼‹é€æ–™ï¼‰</td></tr>
                            <tr><th className="py-4 text-blue-900">å•†å“ä»£é‡‘ä»¥å¤–ã®å¿…è¦æ–™é‡‘</th><td className="py-4 text-slate-600">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šæ–™é‡‘ã€é€šä¿¡æ–™é‡‘ç­‰</td></tr>
                            <tr><th className="py-4 text-blue-900">æ”¯æ‰•æ–¹æ³•</th><td className="py-4 text-slate-600">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆï¼ˆSquareï¼‰</td></tr>
                            <tr><th className="py-4 text-blue-900">å•†å“ã®å¼•æ¸¡æ™‚æœŸ</th><td className="py-4 text-slate-600">ç›®æ¨™é‡‘é¡é”æˆå¾Œã€Amazon/æ¥½å¤©ç­‰ã®åœ¨åº«çŠ¶æ³ã«æº–ã˜ã¦7å–¶æ¥­æ—¥ä»¥å†…ã«ç™ºé€æ‰‹é…</td></tr>
                            <tr><th className="py-4 text-blue-900">ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»è¿”å“</th><td className="py-4 text-slate-600">æ”¯æ´ã¨ã„ã†æ€§è³ªä¸Šã€åŸå‰‡ã¨ã—ã¦ãŠå—ã‘ã§ãã¾ã›ã‚“ã€‚</td></tr>
                        </tbody></table>
                    </div>
                )
            };

            const extractImageFromCode = (code) => {
                if (!code || typeof code !== 'string') return null;
                try {
                    const div = document.createElement('div');
                    div.innerHTML = code;
                    const img = div.querySelector('img');
                    if (img && img.src) return img.src;
                } catch (e) { console.error("Parse error", e); }
                const match = code.match(/<img[^>]+src=["']([^"']+)["']/i);
                return match ? match[1] : null;
            };

            const stats = useMemo(() => {
                const totalPayment = campaigns.reduce((acc, c) => acc + c.current, 0);
                return { 
                    totalPayment, 
                    activeCount: campaigns.length,
                    requestCount: requests.length,
                    stripeFee: Math.floor(totalPayment * 0.036), 
                    adminFee: Math.floor(totalPayment * 0.064), 
                    shipping: campaigns.filter(c => c.current >= calcTarget(c.price)).length * 500 
                };
            }, [campaigns, requests]);

            const handleLogin = () => {
                if (loginEmail === "y.moz.fleet@gmail.com" && loginPass === "Rushers1#") { setIsAdminMode(true); setView('admin'); setShowLogin(false); } else { alert("èªè¨¼ã‚¨ãƒ©ãƒ¼"); }
            };
            const handleLogout = () => { setIsAdminMode(false); setView('home'); setLoginEmail(""); setLoginPass(""); };
            const handleCustomAmountChange = (e) => { setCustomAmountInput(e.target.value); setSelectedAmount(parseInt(e.target.value) || 0); };
            const shareText = (c) => encodeURIComponent(`ã€MySupporterã€‘${c.team}ã®ã€Œ${c.name}ã€ã‚’å¿œæ´ã—ã‚ˆã†ï¼`);
            const shareUrl = "https://mysupporter.example.com";
            const copyToClipboard = () => navigator.clipboard.writeText(shareUrl).then(() => alert("ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));

            const filteredCampaigns = useMemo(() => {
                return campaigns.filter(c => {
                    const match = !searchQuery || c.team.toLowerCase().includes(searchQuery.toLowerCase()) || c.name.toLowerCase().includes(searchQuery.toLowerCase());
                    return match && (c.status === 'active' || c.status === 'completed');
                }).sort((a,b) => (a.current >= calcTarget(a.price) ? 1 : -1) || (b.supporters - a.supporters));
            }, [campaigns, searchQuery]);

            const submitRequest = async () => {
                if(!applyForm.team || !applyForm.email || !applyForm.contactName) return alert("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                if(!applyAgreed) return alert("è¦ç´„ã¸ã®åŒæ„ãŒå¿…è¦ã§ã™");
                
                const teamImgSize = applyForm.teamImage ? applyForm.teamImage.length : 0;
                const itemImgSize = applyForm.image ? applyForm.image.length : 0;
                if ((teamImgSize + itemImgSize) > 950000) return alert("ç”»åƒã®åˆè¨ˆã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚å†åº¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚");

                setIsProcessing(true); 
                try {
                    await db.collection("requests").add({ ...applyForm, estimatedPrice: 0, status: "pending", date: new Date().toLocaleDateString('ja-JP') });
                    alert("ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚");
                    localStorage.removeItem("ms_applyForm");
                    setApplyForm({ team: "", email: "", itemUrl: "", teamUrl: "", snsUrl: "", description: "", image: null, teamImage: null, contactName: "", address: "", phone: "" });
                    setView('home');
                } catch (error) {
                    alert("é€ä¿¡å¤±æ•—: " + error.message);
                } finally { setIsProcessing(false); }
            };
            
            const approveRequest = async (req) => {
                if(!req.estimatedPrice) return alert("æ‰¿èªé‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                await db.collection("campaigns").add({ ...req, name: req.name || "å•†å“åæœªè¨­å®š", price: req.estimatedPrice, current: 0, supporters: 0, status: 'active', month: new Date().toISOString().slice(0, 7) });
                await db.collection("requests").doc(req.id).delete();
                alert("æ‰¿èªãƒ»å…¬é–‹ã—ã¾ã—ãŸ");
            };

            const handlePayment = async () => {
                if (!selectedAmount) return alert("é‡‘é¡ã‚¨ãƒ©ãƒ¼");
                setIsProcessing(true);
                try {
                    const createSquareCheckout = firebase.functions().httpsCallable('createSquareCheckout');
                    const response = await createSquareCheckout({ amount: selectedAmount, campaignId: selectedCampaign.id, name: supporterName, email: supporterEmail });
                    if (response.data && response.data.url) window.location.href = response.data.url;
                    else throw new Error("æ±ºæ¸ˆURLå–å¾—å¤±æ•—");
                } catch (error) {
                    alert("ã‚¨ãƒ©ãƒ¼: " + error.message);
                    setIsProcessing(false);
                }
            };

            const submitReport = async () => {
                if(!reportForm.team || !reportForm.content) return alert("å¿…é ˆé …ç›®ï¼ˆãƒãƒ¼ãƒ åãƒ»æœ¬æ–‡ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
                setIsProcessing(true);
                try {
                    await db.collection("reports").add({ 
                        ...reportForm, 
                        date: new Date().toLocaleDateString('ja-JP') 
                    });
                    localStorage.removeItem("ms_reportForm");
                    setReportForm({ team: "", title: "", content: "", image: null });
                    alert("æ´»å‹•å ±å‘Šã‚’å…¬é–‹ã—ã¾ã—ãŸï¼");
                } catch(e) {
                    console.error(e);
                    alert("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " + e.message);
                } finally {
                    setIsProcessing(false);
                }
            };

            const deleteDoc = async (col, id) => { if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) await db.collection(col).doc(id).delete(); };
            const createDemoOrder = async () => { 
                if(!confirm("ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ")) return;
                await db.collection("campaigns").add({
                    team: "ãƒ‡ãƒ¢ãƒãƒ¼ãƒ ", name: "ãƒ‡ãƒ¢å•†å“", price: 5000, current: 6000, supporters: 5, status: 'active', 
                    itemUrl: "https://example.com", image: "https://placehold.co/400", teamImage: "https://placehold.co/600x400",
                    description: "ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿", contactName: "ãƒ‡ãƒ¢", address: "æ±äº¬", phone: "09000000000", email: "demo@example.com"
                });
                alert("ä½œæˆã—ã¾ã—ãŸ");
            };

            const CampaignCard = ({ c }) => {
                const target = calcTarget(c.price);
                const isGoal = c.current >= target;
                return (
                    <div className="campaign-card glass-panel rounded-[1rem] md:rounded-[2.5rem] p-1.5 md:p-2 border border-white relative cursor-pointer overflow-hidden" onClick={()=>{setSelectedCampaign(c); setView('detail'); setSupportStep(1); setCustomAmountInput(""); window.scrollTo(0,0);}}>
                        {isGoal && <div className="absolute inset-0 z-20 flex items-center justify-center bg-white/60 backdrop-blur-sm rounded-[1rem] md:rounded-[2.5rem]"><div className="goal-stamp border-4 md:border-8 border-pink-500 text-pink-500 text-3xl md:text-6xl font-black p-2 md:p-4 rounded-xl rotate-[-15deg]">GOAL!!</div></div>}
                        <div className="aspect-[16/10] md:aspect-video bg-slate-100 rounded-[0.75rem] md:rounded-[2rem] overflow-hidden m-0.5 md:m-2 relative shadow-inner">
                            <img src={c.teamImage || c.image} className="w-full h-full object-cover"/>
                            <div className="absolute bottom-0 left-0 right-0 p-2 md:p-3 bg-gradient-to-t from-black/60 to-transparent">
                                <span className="bg-white text-blue-900 px-1.5 py-0.5 rounded-full text-[8px] md:text-[10px] font-black">{c.team}</span>
                            </div>
                        </div>
                        <div className="p-2 md:p-6">
                            <h3 className="text-[11px] md:text-xl font-black italic text-slate-800 mb-1 md:mb-2 line-clamp-1">{c.name}</h3>
                            <div className="flex items-center gap-1 mb-1 text-[8px] md:text-xs font-bold text-slate-400"><span className="text-blue-500">ğŸ‘¤</span> {c.supporters || 0}äºº</div>
                            <div className="flex justify-between items-end"><div><p className="text-[7px] md:text-[10px] text-slate-400">ç¾åœ¨</p><span className="text-[11px] md:text-2xl font-black text-blue-600">Â¥{c.current.toLocaleString()}</span></div><div className="text-right"><p className="text-[7px] md:text-[10px] text-slate-400">ç›®æ¨™</p><span className="text-[8px] md:text-xs font-black text-slate-500">/Â¥{target.toLocaleString()}</span></div></div>
                            <ProgressBar current={c.current} target={target} />
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen flex flex-col relative">
                    <LegalModal isOpen={modal.open} title={modal.title} content={modal.content} onClose={() => setModal({open: false, title: '', content: null})} />
                    
                    {showLogin && (
                        <div className="fixed inset-0 z-[100] bg-slate-900/80 backdrop-blur-md flex items-center justify-center fade-in">
                            <div className="glass-panel p-6 md:p-10 rounded-[2rem] w-full max-w-md border border-slate-200 shadow-2xl space-y-6 m-4">
                                <h3 className="text-2xl font-black italic uppercase text-blue-900 text-center">Admin Access</h3>
                                <input className="input-field" placeholder="Email" value={loginEmail} onChange={e=>setLoginEmail(e.target.value)} />
                                <input type="password" className="input-field" placeholder="Code" value={loginPass} onChange={e=>setLoginPass(e.target.value)} />
                                <button onClick={handleLogin} className="w-full py-4 bg-blue-600 text-white rounded-xl font-black italic shadow-lg hover:bg-blue-700">LOGIN</button>
                                <button onClick={()=>setShowLogin(false)} className="w-full text-xs text-slate-500 font-bold hover:text-slate-700">CANCEL</button>
                            </div>
                        </div>
                    )}

                    <nav className="h-16 md:h-24 flex items-center justify-between px-4 md:px-12 sticky top-0 bg-[#f0f4f8]/90 backdrop-blur-xl z-50 border-b border-white/40 gap-4">
                        <div className="flex items-center gap-2 cursor-pointer shrink-0" onClick={() => {setView('home'); setActiveTab('top'); setIsAdminMode(false);}}>
                            <div className="bg-blue-600 w-8 h-8 md:w-10 md:h-10 rounded-xl flex items-center justify-center italic font-black text-white shadow-lg text-lg">S</div>
                            <span className="font-black text-lg md:text-2xl tracking-tighter uppercase italic text-slate-900">MySUPPORTER</span>
                        </div>
                        {!isAdminMode && (
                            <div className="hidden md:block flex-1 max-w-xl relative border border-slate-200 bg-white rounded-2xl transition-all overflow-hidden focus-within:border-blue-500 shadow-sm">
                                <input type="text" placeholder="å­¦æ ¡åã‚„å•†å“ã§æ¤œç´¢..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="w-full bg-transparent py-3 px-12 outline-none text-sm font-bold text-slate-700 placeholder-slate-400" />
                                <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">ğŸ”</div>
                            </div>
                        )}
                        <div className="hidden lg:flex bg-white/50 p-1 rounded-full border border-white/60 shadow-sm">
                            {['campaigns', 'about', 'howitworks', 'thanks'].map(tab => (
                                <button key={tab} onClick={() => {setView('home'); setActiveTab(tab);}} className={`px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === tab ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-500 hover:text-blue-600'}`}>
                                    {tab === 'about' ? 'MySUPPORTERã¨ã¯' : tab === 'campaigns' ? 'æ”¯æ´ä¸€è¦§' : tab === 'howitworks' ? 'ã”åˆ©ç”¨ãƒ•ãƒ­ãƒ¼' : 'æ´»å‹•å ±å‘Š'}
                                </button>
                            ))}
                        </div>
                        <div className="flex gap-2">
                            {!isAdminMode && <button onClick={()=>setView('apply')} className="text-[9px] md:text-[10px] font-black uppercase border border-blue-200 bg-white text-blue-900 px-3 md:px-6 py-1.5 md:py-2 rounded-full hover:bg-blue-600 hover:text-white transition">æ²è¼‰ç”³è«‹</button>}
                            {isAdminMode && <button onClick={handleLogout} className="text-[10px] font-black bg-slate-800 text-white px-4 md:px-6 py-2 rounded-full">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>}
                        </div>
                    </nav>

                    {!isAdminMode && view === 'home' && (
                        <div className="md:hidden sticky top-16 z-40 bg-[#f0f4f8]/95 border-b border-white/40 backdrop-blur-xl overflow-x-auto no-scrollbar shadow-sm">
                            <div className="flex px-4 py-2 gap-2 min-w-max">
                                {['campaigns', 'about', 'howitworks', 'thanks'].map(tab => (
                                    <button key={tab} onClick={() => {setView('home'); setActiveTab(tab); window.scrollTo({ top: 0, behavior: 'smooth' });}} 
                                        className={`px-3 py-1.5 rounded-full text-[9px] font-bold uppercase tracking-widest transition-all whitespace-nowrap 
                                        ${activeTab === tab ? 'bg-blue-600 text-white shadow-md' : 'bg-white text-slate-500 border border-slate-200'}`}>
                                        {tab === 'about' ? 'ã¨ã¯' : tab === 'campaigns' ? 'æ”¯æ´ä¸€è¦§' : tab === 'howitworks' ? 'ãƒ•ãƒ­ãƒ¼' : 'æ´»å‹•å ±å‘Š'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    <main className="flex-grow">
                        {view === 'admin' && isAdminMode ? (
                            <div className="max-w-7xl mx-auto p-4 md:p-12 fade-in">
                                <div className="flex justify-between items-end border-b border-slate-300 pb-4 md:pb-8 mb-8">
                                    <h2 className="text-2xl md:text-4xl font-black italic text-blue-600 uppercase tracking-tighter">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
                                    <button onClick={createDemoOrder} className="bg-slate-200 text-slate-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-slate-300">ã€ãƒ‡ãƒ¢ã€‘é”æˆæ¡ˆä»¶ã‚’ä½œæˆ</button>
                                </div>
                                <div className="flex flex-wrap bg-white p-2 rounded-2xl border border-slate-200 mb-8 gap-2 shadow-sm sticky top-24 z-40">
                                    {['dashboard', 'requests', 'campaigns', 'orders', 'reports', 'revenue'].map(t => (
                                        <button key={t} onClick={()=>setAdminTab(t)} className={`admin-tab ${adminTab===t ? 'active' : ''}`}>
                                            {t==='dashboard'?'ãƒ›ãƒ¼ãƒ (æ¦‚è¦)':t==='requests'?'ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª':t==='campaigns'?'å…¬é–‹ä¸­æ¡ˆä»¶':t==='orders'?'ç™ºæ³¨ç®¡ç†':t==='reports'?'æ´»å‹•å ±å‘Š': 'åç›Šç®¡ç†'}
                                        </button>
                                    ))}
                                </div>
                                {adminTab === 'dashboard' && (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                                        <div className="glass-panel p-8 rounded-[2rem] border-l-8 border-blue-600">
                                            <p className="text-xs font-black text-slate-500 mb-2">ç¾åœ¨ã®ç·å£²ä¸Š</p>
                                            <p className="text-4xl font-black text-slate-800">Â¥{stats.totalPayment.toLocaleString()}</p>
                                        </div>
                                        <div className="glass-panel p-8 rounded-[2rem] border-l-8 border-orange-500">
                                            <p className="text-xs font-black text-slate-500 mb-2">æœªæ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆ</p>
                                            <p className="text-4xl font-black text-orange-500">{stats.requestCount}ä»¶</p>
                                        </div>
                                        <div className="glass-panel p-8 rounded-[2rem] border-l-8 border-green-500">
                                            <p className="text-xs font-black text-slate-500 mb-2">å…¬é–‹ä¸­ã®æ¡ˆä»¶</p>
                                            <p className="text-4xl font-black text-green-600">{stats.activeCount}ä»¶</p>
                                        </div>
                                    </div>
                                )}
                                {adminTab === 'requests' && <div className="grid gap-6">{requests.length === 0 ? <p className="text-center text-slate-400 py-10">ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p> : requests.map(req => (
                                    <div key={req.id} className="glass-panel p-6 md:p-8 rounded-[2rem] grid grid-cols-1 md:grid-cols-3 gap-8 border-l-8 border-blue-600">
                                        <div className="space-y-4">
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-bold text-slate-500 flex justify-between">ãƒãƒ¼ãƒ å†™çœŸ (ãƒ¡ã‚¤ãƒ³)<button onClick={()=>saveRequestToDB(req.id, 'teamImage', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></label>
                                                <div className="aspect-video bg-slate-100 rounded-2xl overflow-hidden flex items-center justify-center relative shadow-inner group">
                                                    {req.teamImage ? <img src={req.teamImage} className="w-full h-full object-cover"/> : <span className="text-xs text-slate-400">ãªã—</span>}
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e => handleImageUpload(e, r => { handleRequestLocalUpdate(req.id, 'teamImage', r); saveRequestToDB(req.id, 'teamImage', r); })} /></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-bold text-slate-500 flex justify-between">å•†å“å†™çœŸ<button onClick={()=>saveRequestToDB(req.id, 'image', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></label>
                                                <div className="aspect-square bg-white rounded-xl overflow-hidden flex items-center justify-center border border-slate-200 group relative">
                                                    {req.image ? <img src={req.image} className="w-full h-full object-contain"/> : <span className="text-slate-400 font-bold text-xs">æœªè¨­å®š</span>}
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e => handleImageUpload(e, r => { handleRequestLocalUpdate(req.id, 'image', r); saveRequestToDB(req.id, 'image', r); })} /></label>
                                                    </div>
                                                </div>
                                                <textarea className="input-field text-xs h-12" placeholder="æ¥½å¤©ã‚³ãƒ¼ãƒ‰" value={rakutenCodes[req.id]||""} onChange={e=>setRakutenCodes({...rakutenCodes,[req.id]:e.target.value})}/>
                                                <button className="w-full py-2 bg-slate-200 rounded-lg text-xs font-bold hover:bg-slate-300" onClick={()=>{ const src=extractImageFromCode(rakutenCodes[req.id]); if(src) { setRequests(requests.map(r=>r.id===req.id?{...r,image:src}:r)); saveRequestToDB(req.id, 'image', src); } else { alert("ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚"); } }}>ç”»åƒé©ç”¨</button>
                                            </div>
                                            <a href={req.itemUrl} target="_blank" className="text-xs text-blue-500 underline block text-center">å•†å“URLã‚’ç¢ºèª</a>
                                        </div>
                                        <div className="md:col-span-2 space-y-4">
                                            <div className="flex justify-between items-start">
                                                <h3 className="text-2xl font-black text-slate-800">{req.team}</h3>
                                                <span className="bg-blue-100 text-blue-600 text-[10px] font-bold px-2 py-1 rounded">æ‰¿èªå¾…ã¡</span>
                                            </div>
                                            <div className="bg-white p-4 rounded-xl text-xs space-y-1 border border-slate-200 shadow-sm">
                                                <p><span className="text-slate-500 font-bold">æ‹…å½“è€…:</span> {req.contactName || 'æœªè¨˜å…¥'}</p>
                                                <p><span className="text-slate-500 font-bold">é›»è©±ç•ªå·:</span> {req.phone || 'æœªè¨˜å…¥'}</p>
                                                <p><span className="text-slate-500 font-bold">ä½æ‰€:</span> {req.address || 'æœªè¨˜å…¥'}</p>
                                                <p><span className="text-slate-500 font-bold">Email:</span> {req.email}</p>
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500">å•†å“å (æ‰¿èªå¾Œè¡¨ç¤º)</label>
                                                <input className="input-field text-sm" placeholder="å•†å“åã‚’å…¥åŠ›" value={req.name||''} onChange={e => handleRequestLocalUpdate(req.id, 'name', e.target.value)} onBlur={e => saveRequestToDB(req.id, 'name', e.target.value)} />
                                            </div>
                                            <div className="bg-blue-50 p-4 rounded-xl border border-blue-100"><label className="text-[10px] font-bold text-blue-600">æ‰¿èªé‡‘é¡ (Â¥)</label>
                                                <input type="number" className="input-field text-xl" value={req.estimatedPrice||''} onChange={e => handleRequestLocalUpdate(req.id, 'estimatedPrice', parseInt(e.target.value))} onBlur={e => saveRequestToDB(req.id, 'estimatedPrice', parseInt(e.target.value))} />
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-bold text-slate-500">ãƒªã‚¯ã‚¨ã‚¹ãƒˆç†ç”±</label>
                                                <textarea className="input-field text-sm h-20" value={req.description||''} onChange={e => handleRequestLocalUpdate(req.id, 'description', e.target.value)} onBlur={e => saveRequestToDB(req.id, 'description', e.target.value)}></textarea>
                                            </div>
                                            <div className="flex gap-4"><button onClick={()=>approveRequest(req)} className="flex-1 bg-blue-600 text-white py-3 rounded-xl font-black text-xs hover:bg-blue-700 shadow-lg transition transform hover:scale-[1.02]">æ‰¿èªã—ã¦å…¬é–‹</button><button onClick={()=>deleteDoc("requests", req.id)} className="px-8 border border-slate-300 text-red-500 rounded-xl font-black text-xs hover:bg-red-50 transition">å‰Šé™¤</button></div>
                                        </div>
                                    </div>
                                ))}</div>}
                                {adminTab === 'campaigns' && <div className="grid gap-4">{campaigns.map(c => (
                                    <div key={c.id} className="glass-panel p-6 rounded-3xl flex flex-col md:flex-row gap-6 items-start border-l-4 border-green-500">
                                        <div className="w-full md:w-48 shrink-0 space-y-4">
                                            <div>
                                                <p className="text-[10px] font-bold text-slate-500 mb-1 flex justify-between">ãƒãƒ¼ãƒ å†™çœŸ<button onClick={()=>saveToDB(c.id, 'teamImage', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></p>
                                                <div className="w-full aspect-video bg-slate-100 rounded-xl overflow-hidden relative group">
                                                    <img src={c.teamImage || "https://placehold.co/600x400"} className="w-full h-full object-cover"/>
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e=>handleImageUpload(e, r=>saveToDB(c.id, 'teamImage', r))} /></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                <p className="text-[10px] font-bold text-slate-500 mb-1 flex justify-between">å•†å“ç”»åƒ<button onClick={()=>saveToDB(c.id, 'image', null)} className="text-red-500 hover:underline">å‰Šé™¤</button></p>
                                                <div className="w-full h-24 bg-white rounded-xl overflow-hidden border border-slate-200 relative group">
                                                    <img src={c.image} className="w-full h-full object-contain"/>
                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                                        <label className="cursor-pointer text-white text-xs font-bold p-2 hover:bg-white/20 rounded">å¤‰æ›´<input type="file" className="hidden" onChange={e=>handleImageUpload(e, r=>saveToDB(c.id, 'image', r))} /></label>
                                                    </div>
                                                </div>
                                                <input className="input-field py-1 px-2 text-[10px] w-full mt-1" placeholder="æ¥½å¤©ã‚³ãƒ¼ãƒ‰" value={rakutenCodes[c.id]||""} onChange={e=>setRakutenCodes({...rakutenCodes,[c.id]:e.target.value})}/><button className="w-full py-1 bg-slate-200 rounded-lg text-[10px] font-bold mt-1 hover:bg-slate-300" onClick={()=>{const src=extractImageFromCode(rakutenCodes[c.id]);if(src)saveToDB(c.id, 'image', src); else alert("ç”»åƒãªã—")}}>ç”»åƒæ›´æ–°</button>
                                            </div>
                                        </div>
                                        <div className="flex-grow space-y-4 w-full">
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                <div><label className="text-[10px] text-slate-500 font-bold">ãƒãƒ¼ãƒ å</label><input className="input-field py-1 px-2 text-xs" value={c.team} onChange={e=>handleLocalUpdate(c.id, 'team', e.target.value)} onBlur={e=>saveToDB(c.id, 'team', e.target.value)} /></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">å•†å“å</label><input className="input-field py-1 px-2 text-xs" value={c.name} onChange={e=>handleLocalUpdate(c.id, 'name', e.target.value)} onBlur={e=>saveToDB(c.id, 'name', e.target.value)} /></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">ä¾¡æ ¼</label><input type="number" className="input-field py-1 px-2 text-xs" value={c.price} onChange={e=>handleLocalUpdate(c.id, 'price', parseInt(e.target.value))} onBlur={e=>saveToDB(c.id, 'price', parseInt(e.target.value))} /></div>
                                                <div><label className="text-[10px] text-slate-500 font-bold">URL</label><input className="input-field py-1 px-2 text-[10px]" value={c.teamUrl||""} onChange={e=>handleLocalUpdate(c.id, 'teamUrl', e.target.value)} onBlur={e=>saveToDB(c.id, 'teamUrl', e.target.value)} /></div>
                                            </div>
                                            <div>
                                                <label className="text-[10px] text-slate-500 font-bold">èª¬æ˜æ–‡</label>
                                                <textarea className="input-field py-2 px-2 text-xs h-16" value={c.description||''} onChange={e=>handleLocalUpdate(c.id, 'description', e.target.value)} onBlur={e=>saveToDB(c.id, 'description', e.target.value)}></textarea>
                                            </div>
                                        </div>
                                        <button onClick={()=>deleteDoc("campaigns", c.id)} className="text-xs font-black border border-red-200 text-red-500 px-4 py-2 rounded-lg hover:bg-red-50">å‰Šé™¤</button>
                                    </div>
                                ))}</div>}
                                {adminTab === 'reports' && (
                                    <div className="space-y-8">
                                        <div className="glass-panel p-6 md:p-10 rounded-[3rem] border border-blue-500/20">
                                            <h3 className="text-lg font-black italic mb-8 uppercase text-blue-900">æ´»å‹•å ±å‘Šä½œæˆ</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                                <div className="space-y-4">
                                                    <input className="input-field" placeholder="å¯¾è±¡ãƒãƒ¼ãƒ å" value={reportForm.team} onChange={e=>setReportForm({...reportForm, team: e.target.value})} />
                                                    <input className="input-field" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" value={reportForm.title} onChange={e=>setReportForm({...reportForm, title: e.target.value})} />
                                                    <div className="h-40 border-2 border-dashed border-slate-300 rounded-2xl flex items-center justify-center relative hover:bg-slate-50 transition">
                                                        {reportForm.image ? <img src={reportForm.image} className="w-full h-full object-cover rounded-xl"/> : <span className="text-slate-400 font-bold">Image</span>}
                                                        <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e=>handleImageUpload(e, r=>setReportForm({...reportForm, image: r}))} />
                                                    </div>
                                                </div>
                                                <textarea className="input-field h-full min-h-[200px]" placeholder="æœ¬æ–‡" value={reportForm.content} onChange={e=>setReportForm({...reportForm, content: e.target.value})}></textarea>
                                            </div>
                                            <button onClick={isProcessing ? null : submitReport} disabled={isProcessing} className="w-full mt-8 bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-blue-700">{isProcessing ? "å‡¦ç†ä¸­..." : "å…¬é–‹ã™ã‚‹"}</button>
                                        </div>
                                        <div className="glass-panel p-6 md:p-10 rounded-[3rem]">
                                            <h3 className="text-lg font-black italic mb-8 uppercase text-slate-700">ç®¡ç†</h3>
                                            <div className="space-y-4">
                                                {reports.map(r => (
                                                    <div key={r.id} className="flex items-center gap-4 bg-white p-4 rounded-xl border border-slate-200">
                                                        <img src={r.image || "https://placehold.co/100"} className="w-16 h-16 rounded-lg object-cover" />
                                                        <div className="flex-1">
                                                            <h4 className="font-bold text-slate-800">{r.title}</h4>
                                                            <p className="text-xs text-slate-500">{r.date} - {r.team}</p>
                                                        </div>
                                                        <button onClick={() => deleteDoc('reports', r.id)} className="text-xs font-black text-red-500 border border-red-500 px-3 py-1 rounded">å‰Šé™¤</button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ) : view === 'home' ? (
                            <>
                                {activeTab === 'top' && (
                                    <>
                                        <section className="pt-8 pb-4 md:pt-32 md:pb-24 px-4 md:px-8 text-center fade-in">
                                            <h1 className="text-4xl md:text-[9rem] font-black italic tracking-tighter uppercase leading-[0.9] text-slate-900">
                                                Support Your<br/><span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-400">Dream Team.</span>
                                            </h1>
                                            <p className="text-sm md:text-3xl font-black text-slate-500 mt-4 md:mt-8 tracking-wider">
                                                ãã®ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãŒã€åŠ›ã«ãªã‚‹ã€‚
                                            </p>
                                        </section>
                                        <div className="max-w-7xl mx-auto px-2 md:px-8 grid grid-cols-2 lg:grid-cols-3 gap-2 md:gap-8 pb-20">
                                            {filteredCampaigns.map(c => <CampaignCard key={c.id} c={c} />)}
                                        </div>
                                    </>
                                )}

                                {activeTab === 'campaigns' && (
                                    <div className="max-w-7xl mx-auto px-2 md:px-8 grid grid-cols-2 lg:grid-cols-3 gap-2 md:gap-8 py-6 md:py-32 fade-in">
                                        {filteredCampaigns.map(c => <CampaignCard key={c.id} c={c} />)}
                                    </div>
                                )}

                                {activeTab === 'about' && (
                                    <div className="max-w-6xl mx-auto py-8 md:py-24 px-4 md:px-8 fade-in text-center">
                                        <h2 className="text-3xl md:text-7xl font-black italic uppercase tracking-tighter text-blue-600 mb-4">Why MySUPPORTER?</h2>
                                        <p className="text-sm md:text-2xl font-bold text-slate-500 mb-8 md:mb-12">ã€Œä¸é€æ˜ã€ãªå¯„ä»˜ã‚’çµ‚ã‚ã‚‰ã›ã‚‹ã€‚<br />ãƒ¢ãƒãŒå±Šãã€æ–°ã—ã„å¿œæ´ã®ã‚«ã‚¿ãƒã€‚</p>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                                            {[
                                                {title: "100%ã®é€æ˜æ€§", text: "æ”¯æ´é‡‘ã¯æŒ‡å®šã•ã‚ŒãŸç‰©å“è³¼å…¥ã«ã®ã¿ä½¿ã‚ã‚Œã¾ã™ã€‚", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},
                                                {title: "ãƒ¢ãƒã§å±Šã", text: "ç¾é‡‘ã§ã¯ãªãæ–°å“ã®ç”¨å…·ãŒå±Šãã€æ´»å‹•ã‚’æ”¯ãˆã¾ã™ã€‚", icon: "M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"},
                                                {title: "æ´»å‹•ãŒè¦‹ãˆã‚‹", text: "ãƒãƒ¼ãƒ ã‹ã‚‰å†™çœŸä»˜ãã®å ±å‘ŠãŒå±Šãã€æˆæœã‚’å®Ÿæ„Ÿã§ãã¾ã™ã€‚", icon: "M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15"}
                                            ].map((f, i) => (
                                                <div key={i} className="glass-panel p-6 md:p-8 rounded-[1.5rem] md:rounded-[2.5rem] text-left">
                                                    <div className="w-10 h-10 md:w-16 md:h-16 bg-blue-100 rounded-xl md:rounded-2xl flex items-center justify-center mb-4 text-blue-600">
                                                        <svg className="w-6 h-6 md:w-8 md:h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={f.icon} /></svg>
                                                    </div>
                                                    <h4 className="text-base md:text-xl font-black italic text-slate-800 mb-2">{f.title}</h4>
                                                    <p className="text-xs md:text-sm text-slate-500">{f.text}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {activeTab === 'howitworks' && (
                                    <div className="max-w-6xl mx-auto py-6 md:py-24 px-4 md:px-8 fade-in space-y-8 md:space-y-24">
                                        <div>
                                            <div className="text-center mb-6 md:mb-12">
                                                <h2 className="text-2xl md:text-4xl font-black italic uppercase tracking-tighter text-slate-900">ãƒãƒ¼ãƒ ã®æ–¹ã¸</h2>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-6">
                                                {[
                                                    {step: "01", title: "å•†å“é¸å®š", text: "Amazonã‚„æ¥½å¤©ã§URLã‚’ã‚³ãƒ”ãƒ¼"},
                                                    {step: "02", title: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆ", text: "å°‚ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æ²è¼‰ã‚’ç”³è«‹"},
                                                    {step: "03", title: "å—ã‘å–ã‚Š", text: "ç›®æ¨™é”æˆã§å•†å“ãŒãƒãƒ¼ãƒ ã«å±Šã"}
                                                ].map((s, i) => (
                                                    <div key={i} className="glass-panel p-4 md:p-8 rounded-[1rem] md:rounded-[2rem] relative overflow-hidden">
                                                        <div className="text-4xl md:text-7xl font-black italic text-slate-100 absolute -top-1 md:-top-2 -right-1 md:-right-2">{s.step}</div>
                                                        <h3 className="text-sm md:text-xl font-black italic mb-1 md:mb-3 text-blue-600 relative z-10">{s.title}</h3>
                                                        <p className="text-[11px] md:text-sm text-slate-500 font-bold relative z-10">{s.text}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div>
                                            <div className="text-center mb-6 md:mb-12">
                                                <h2 className="text-2xl md:text-4xl font-black italic uppercase tracking-tighter text-slate-900">ã‚µãƒãƒ¼ã‚¿ãƒ¼ã®æ–¹ã¸</h2>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-6">
                                                {[
                                                    {step: "01", title: "ãƒãƒ¼ãƒ ã‚’æ¢ã™", text: "å¿œæ´ã—ãŸã„ãƒãƒ¼ãƒ ã‚’ä¸€è¦§ã‹ã‚‰é¸ã¶"},
                                                    {step: "02", title: "æ”¯æ´ã™ã‚‹", text: "å°‘é¡ã‹ã‚‰ã§ã‚‚ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã§æ”¯æ´"},
                                                    {step: "03", title: "æ´»å‹•å ±å‘Š", text: "ãƒãƒ¼ãƒ ã‹ã‚‰æ„Ÿè¬ã®å ±å‘ŠãŒå±Šã"}
                                                ].map((s, i) => (
                                                    <div key={i} className="glass-panel p-4 md:p-8 rounded-[1rem] md:rounded-[2rem] relative overflow-hidden">
                                                        <div className="text-4xl md:text-7xl font-black italic text-slate-100 absolute -top-1 md:-top-2 -right-1 md:-right-2">{s.step}</div>
                                                        <h3 className="text-sm md:text-xl font-black italic mb-1 md:mb-3 text-blue-600 relative z-10">{s.title}</h3>
                                                        <p className="text-[11px] md:text-sm text-slate-500 font-bold relative z-10">{s.text}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'thanks' && (
                                    <div className="max-w-4xl mx-auto py-8 md:py-20 px-4 md:px-8 fade-in">
                                        <h2 className="text-center text-2xl md:text-3xl font-black italic uppercase mb-8 text-blue-600">æ´»å‹•å ±å‘Š</h2>
                                        {reports.length === 0 ? 
                                            <p className="text-center text-slate-400 font-bold">ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p> :
                                            <div className="space-y-4 md:space-y-8">
                                                {reports.map(r=>(
                                                    <div key={r.id} className="glass-panel p-4 md:p-8 rounded-[1.5rem] md:rounded-[2rem] flex flex-col md:flex-row gap-4 md:gap-8 items-start">
                                                        <div className="w-full md:w-48 aspect-video bg-slate-100 rounded-xl overflow-hidden shrink-0">
                                                            <img src={r.image || "https://placehold.co/400x300"} className="w-full h-full object-cover"/>
                                                        </div>
                                                        <div>
                                                            <div className="flex items-baseline gap-2 mb-1">
                                                                <span className="text-[8px] md:text-[10px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded font-bold">{r.team}</span>
                                                                <span className="text-[9px] md:text-xs text-slate-400">{r.date}</span>
                                                            </div>
                                                            <h3 className="text-sm md:text-xl font-black text-slate-800 mb-1">{r.title}</h3>
                                                            <p className="text-[11px] md:text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">{r.content}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        }
                                    </div>
                                )}
                            </>
                        ) : view === 'detail' ? (
                            <div className="max-w-6xl mx-auto p-2 md:p-4 pb-20">
                                <button onClick={()=>setView('home')} className="text-slate-400 font-black text-xs mb-2 hover:text-blue-600">â† BACK</button>
                                <div className="grid grid-cols-1 lg:grid-cols-5 gap-4">
                                    <div className="lg:col-span-3">
                                        <div className="glass-panel p-3 md:p-6 rounded-[1.5rem] md:rounded-[2rem] border-t-4 border-blue-600 relative overflow-hidden">
                                            {selectedCampaign.current >= calcTarget(selectedCampaign.price) && <div className="absolute top-4 right-4 z-20"><div className="goal-stamp border-4 border-pink-500 text-pink-500 text-3xl font-black p-2 rounded-lg rotate-[-15deg] opacity-50">GOAL!!</div></div>}
                                            <div className="relative rounded-xl md:rounded-2xl overflow-hidden aspect-video shadow-lg mb-4 md:mb-6 group bg-slate-100">
                                                <img src={selectedCampaign.teamImage || selectedCampaign.image} className="w-full h-full object-cover transition duration-700 group-hover:scale-105"/>
                                                <div className="absolute bottom-0 left-0 right-0 p-3 md:p-4 bg-gradient-to-t from-black/80 to-transparent">
                                                    <h2 className="text-lg md:text-3xl font-black italic text-white leading-tight">{selectedCampaign.name}</h2>
                                                    <p className="text-white/80 font-bold text-[10px] md:text-xs mt-1">{selectedCampaign.team}</p>
                                                </div>
                                            </div>
                                            <div className="flex flex-col md:flex-row gap-4 md:gap-6">
                                                <div className="flex-1">
                                                    <h4 className="text-[9px] md:text-xs font-black text-blue-600 uppercase mb-2 flex items-center gap-2">
                                                        <span className="w-6 h-[2px] bg-blue-600 inline-block"></span> Why we need this
                                                    </h4>
                                                    <div className="text-[11px] md:text-sm text-slate-600 font-medium whitespace-pre-wrap leading-relaxed">
                                                        {selectedCampaign.description}
                                                    </div>
                                                </div>
                                                <div className="w-full md:w-40 shrink-0">
                                                    <div className="bg-white p-2 rounded-xl border border-slate-200 shadow-sm">
                                                        <div className="text-[9px] text-center font-bold text-slate-400 mb-1">Target Item</div>
                                                        <div className="w-full h-24 md:h-32 flex items-center justify-center overflow-hidden rounded-lg">
                                                            <img src={selectedCampaign.image} className="max-h-full max-w-full object-contain"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="mt-4 flex justify-end gap-2">
                                                <button onClick={copyToClipboard} className="w-7 h-7 bg-slate-100 rounded-full flex items-center justify-center text-[10px] text-slate-500">ğŸ”—</button>
                                                <a href={`https://twitter.com/intent/tweet?text=${shareText(selectedCampaign)}&url=${shareUrl}`} target="_blank" className="w-7 h-7 bg-black rounded-full flex items-center justify-center text-[9px] text-white">ğ•</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="lg:col-span-2">
                                        <div className="glass-panel p-4 md:p-6 rounded-[1.5rem] md:rounded-[2rem] border border-white/50 sticky top-4 shadow-xl">
                                            {supportStep===1 && <div className="space-y-3 md:space-y-4">
                                                <h3 className="text-center font-black italic text-blue-600 text-[10px] md:text-sm">STEP 1: é‡‘é¡é¸æŠ</h3>
                                                <div className="text-center bg-blue-50/50 rounded-lg p-2 md:p-3 border border-blue-100">
                                                    {(() => {
                                                        const target = calcTarget(selectedCampaign.price);
                                                        const remaining = target - selectedCampaign.current;
                                                        if (remaining <= 0) return <p className="text-lg font-black text-green-600">GOAL REACHED!</p>;
                                                        return <><p className="text-[9px] text-slate-500">ã‚ã¨</p><p className="text-lg md:text-2xl font-black text-blue-900">Â¥{remaining.toLocaleString()}</p></>;
                                                    })()}
                                                </div>
                                                {(() => {
                                                    const remaining = calcTarget(selectedCampaign.price) - selectedCampaign.current;
                                                    if (remaining > 0) return (
                                                        <button onClick={()=>{setSelectedAmount(remaining);setSupportStep(2)}} className="w-full py-2 bg-gradient-to-r from-blue-600 to-cyan-500 text-white rounded-lg font-black italic text-[10px] flex justify-between px-3 items-center">
                                                            <span>å…¨é¡æ”¯æ´</span><span>Â¥{remaining.toLocaleString()}</span>
                                                        </button>
                                                    );
                                                })()}
                                                <div className="grid grid-cols-3 gap-2">{[1000,3000,5000].map(v=><button key={v} onClick={()=>{setSelectedAmount(v);setSupportStep(2)}} className="py-2 border border-slate-200 bg-white rounded-lg font-black text-[10px] text-slate-600">Â¥{v.toLocaleString()}</button>)}</div>
                                                <div className="flex gap-2"><input type="number" className="input-field text-center text-[10px] h-8" placeholder="é‡‘é¡æŒ‡å®š" onChange={handleCustomAmountChange}/><button onClick={()=>{if(selectedAmount>=1000)setSupportStep(2)}} className="px-3 bg-slate-800 text-white rounded-lg font-black text-[10px]">æ±ºå®š</button></div>
                                            </div>}
                                            {supportStep===2 && <div className="space-y-3">
                                                <h3 className="text-center font-black italic text-blue-600 text-[10px]">STEP 2: æƒ…å ±</h3>
                                                <p className="text-center text-lg font-black text-slate-900">Â¥{selectedAmount.toLocaleString()}</p>
                                                <input className="input-field text-[11px] h-9" placeholder="åå‰" value={supporterName} onChange={e=>setSupporterName(e.target.value)} />
                                                <input className="input-field text-[11px] h-9" placeholder="Email" value={supporterEmail} onChange={e=>setSupporterEmail(e.target.value)} />
                                                <button onClick={()=>setSupportStep(3)} className="w-full py-2.5 bg-blue-600 text-white rounded-lg font-black text-[11px]">æ¬¡ã¸</button>
                                            </div>}
                                            {supportStep===3 && <div className="space-y-3 text-center">
                                                <h3 className="font-black italic text-[10px] text-blue-600">STEP 3: æ±ºæ¸ˆ</h3>
                                                <button 
                                                    onClick={isProcessing ? null : handlePayment} 
                                                    disabled={isProcessing}
                                                    className="w-full py-2.5 bg-blue-600 text-white rounded-lg font-black text-sm shadow-xl"
                                                >
                                                    {isProcessing ? "å‡¦ç†ä¸­..." : "Squareã§æ±ºæ¸ˆ"}
                                                </button>
                                            </div>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ) : view === 'apply' ? (
                            <div className="max-w-2xl mx-auto py-8 md:py-24 px-4 md:px-8 fade-in">
                                <h2 className="text-2xl md:text-4xl font-black italic text-center text-blue-600 mb-6 md:mb-16">æ²è¼‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
                                <div className="glass-panel p-6 md:p-12 rounded-[2rem] space-y-4 border-t-[8px] border-blue-600">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-blue-50 p-3 rounded-xl border border-blue-100">
                                            <p className="text-[10px] font-bold text-blue-800 mb-2">ğŸ“¸ ãƒãƒ¼ãƒ å†™çœŸ</p>
                                            <div className="w-full aspect-video bg-white rounded-xl overflow-hidden flex items-center justify-center border border-blue-100 relative">
                                                {applyForm.teamImage ? <img src={applyForm.teamImage} className="w-full h-full object-cover"/> : <span className="text-blue-200 font-bold text-xl">+</span>}
                                                <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => handleImageUpload(e, r => setApplyForm({...applyForm, teamImage: r}))} />
                                            </div>
                                        </div>
                                        <div className="bg-blue-50 p-3 rounded-xl border border-blue-100">
                                            <p className="text-[10px] font-bold text-blue-800 mb-2">ğŸ å•†å“ç”»åƒ</p>
                                            <div className="w-full aspect-video bg-white rounded-xl overflow-hidden flex items-center justify-center border border-blue-100 relative">
                                                {applyForm.image ? <img src={applyForm.image} className="w-full h-full object-contain"/> : <span className="text-blue-200 font-bold text-xl">+</span>}
                                                <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => handleImageUpload(e, r => setApplyForm({...applyForm, image: r}))} />
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3"><input className="input-field text-sm py-2" placeholder="ãƒãƒ¼ãƒ å" value={applyForm.team} onChange={e=>setApplyForm({...applyForm, team: e.target.value})} /><input className="input-field text-sm py-2" placeholder="Email" value={applyForm.email} onChange={e=>setApplyForm({...applyForm, email: e.target.value})} /></div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3"><input className="input-field text-sm py-2" placeholder="ãŠåå‰" value={applyForm.contactName} onChange={e=>setApplyForm({...applyForm, contactName: e.target.value})} /><input className="input-field text-sm py-2" placeholder="é›»è©±ç•ªå·" value={applyForm.phone} onChange={e=>setApplyForm({...applyForm, phone: e.target.value})} /></div>
                                    <input className="input-field text-sm py-2" placeholder="ç™ºé€å…ˆä½æ‰€" value={applyForm.address} onChange={e=>setApplyForm({...applyForm, address: e.target.value})} />
                                    <input className="input-field text-sm py-2" placeholder="ã»ã—ã„å•†å“URL" value={applyForm.itemUrl} onChange={e=>setApplyForm({...applyForm, itemUrl: e.target.value})} />
                                    <textarea className="input-field h-24 text-sm" placeholder="ç†ç”±" value={applyForm.description} onChange={e=>setApplyForm({...applyForm, description: e.target.value})}></textarea>
                                    <div className="bg-white p-3 rounded-xl flex gap-3 items-start border border-slate-200">
                                        <input type="checkbox" className="mt-1" checked={applyAgreed} onChange={()=>setApplyAgreed(!applyAgreed)} />
                                        <p className="text-[10px] text-slate-500">åˆ©ç”¨è¦ç´„ãŠã‚ˆã³è™šå½ç”³è«‹ã§ãªã„ã“ã¨ã«åŒæ„ã—ã¾ã™ã€‚</p>
                                    </div>
                                    <button onClick={isProcessing ? null : submitRequest} disabled={isProcessing || !applyAgreed} className="w-full py-4 bg-blue-600 text-white rounded-2xl font-black text-lg shadow-xl">
                                        {isProcessing ? "é€ä¿¡ä¸­..." : "é€ä¿¡"}
                                    </button>
                                </div>
                            </div>
                        ) : null}
                    </main>

                    <footer className="border-t border-slate-200 py-8 md:py-16 px-8 bg-white text-center">
                        <div className="max-w-7xl mx-auto flex flex-col items-center gap-4">
                            <div><span className="font-black italic text-lg text-slate-900">MySUPPORTER</span><p onClick={()=>{if(!isAdminMode)setShowLogin(true)}} className="text-[9px] font-bold text-slate-400 mt-1 cursor-pointer">Â© 2026 MySUPPORTER.</p></div>
                            <div className="flex flex-wrap justify-center gap-4">
                                <button onClick={()=>setModal({open:true, title:'åˆ©ç”¨è¦ç´„', content:docContent.terms})} className="text-[9px] font-black text-slate-500">è¦ç´„</button>
                                <button onClick={()=>setModal({open:true, title:'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼', content:docContent.privacy})} className="text-[9px] font-black text-slate-500">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</button>
                                <button onClick={()=>setModal({open:true, title:'ç‰¹å•†æ³•', content:docContent.tokusho})} className="text-[9px] font-black text-slate-500">ç‰¹å•†æ³•</button>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
